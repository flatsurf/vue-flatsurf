{"version":3,"sources":["webpack://vue-flatsurf/./demo/App.vue?e467","webpack://vue-flatsurf/./src/components/PanZoom.vue?9bec","webpack://vue-flatsurf/./src/geometry/Point.ts","webpack://vue-flatsurf/./src/geometry/Box.ts","webpack://vue-flatsurf/./src/geometry/Polygon.ts","webpack://vue-flatsurf/./src/geometry/Vector.ts","webpack://vue-flatsurf/./src/geometry/Segment.ts","webpack://vue-flatsurf/./src/geometry/Line.ts","webpack://vue-flatsurf/./src/geometry/CoordinateSystem.ts","webpack://vue-flatsurf/./src/geometry/Viewport.ts","webpack://vue-flatsurf/./src/components/PanZoom.vue","webpack://vue-flatsurf/./src/components/PanZoom.vue?9fa1","webpack://vue-flatsurf/./src/components/PanZoom.vue?7336","webpack://vue-flatsurf/./src/components/SurfaceViewer.vue?f615","webpack://vue-flatsurf/./src/geometry/triangulation/Permutation.ts","webpack://vue-flatsurf/./src/geometry/triangulation/FlatTriangulation.ts","webpack://vue-flatsurf/./src/geometry/triangulation/Automorphism.ts","webpack://vue-flatsurf/./src/geometry/triangulation/SaddleConnection.ts","webpack://vue-flatsurf/./src/geometry/triangulation/FlowConnection.ts","webpack://vue-flatsurf/./src/geometry/triangulation/FlowComponent.ts","webpack://vue-flatsurf/./src/components/Surface.vue?0d8e","webpack://vue-flatsurf/./src/components/FlatTriangulation.vue?8b1f","webpack://vue-flatsurf/./src/components/Face.vue?9b41","webpack://vue-flatsurf/./src/components/svg/Ngon.vue?bfe0","webpack://vue-flatsurf/./src/components/svg/Ngon.vue","webpack://vue-flatsurf/./src/components/svg/Ngon.vue?259e","webpack://vue-flatsurf/./src/components/svg/Ngon.vue?ed49","webpack://vue-flatsurf/./src/components/Face.vue","webpack://vue-flatsurf/./src/components/Face.vue?dab4","webpack://vue-flatsurf/./src/components/Face.vue?1bf1","webpack://vue-flatsurf/./src/components/HalfEdge.vue?0c88","webpack://vue-flatsurf/./src/components/svg/Segment.vue?05fe","webpack://vue-flatsurf/./src/components/svg/Segment.vue","webpack://vue-flatsurf/./src/components/svg/Segment.vue?4ff6","webpack://vue-flatsurf/./src/components/svg/Segment.vue?c246","webpack://vue-flatsurf/./src/components/svg/SegmentLabel.vue?7b2c","webpack://vue-flatsurf/./src/components/svg/SegmentLabel.vue","webpack://vue-flatsurf/./src/components/svg/SegmentLabel.vue?f6d6","webpack://vue-flatsurf/./src/components/svg/SegmentLabel.vue?aaf3","webpack://vue-flatsurf/./src/components/svg/Arrow.vue?3c20","webpack://vue-flatsurf/./src/components/svg/Arrow.vue","webpack://vue-flatsurf/./src/components/svg/Arrow.vue?d680","webpack://vue-flatsurf/./src/components/svg/Arrow.vue?5da5","webpack://vue-flatsurf/./src/components/svg/ExtendedClickArea.vue?3af8","webpack://vue-flatsurf/./src/components/svg/ExtendedClickArea.vue","webpack://vue-flatsurf/./src/components/HalfEdgeConfiguration.ts","webpack://vue-flatsurf/./src/components/HalfEdge.vue","webpack://vue-flatsurf/./src/components/HalfEdge.vue?2ee5","webpack://vue-flatsurf/./src/components/HalfEdge.vue?fa65","webpack://vue-flatsurf/./src/components/FlatTriangulation.vue","webpack://vue-flatsurf/./src/components/FlatTriangulation.vue?e38e","webpack://vue-flatsurf/./src/components/FlatTriangulation.vue?9e07","webpack://vue-flatsurf/./src/components/FlowComponent.vue?33bf","webpack://vue-flatsurf/./src/components/SaddleConnection.vue?21aa","webpack://vue-flatsurf/./src/components/SaddleConnection.vue","webpack://vue-flatsurf/./src/components/SaddleConnection.vue?4ee1","webpack://vue-flatsurf/./src/components/SaddleConnection.vue?5a2a","webpack://vue-flatsurf/./src/components/FlowComponent.vue","webpack://vue-flatsurf/./src/components/FlowComponent.vue?4dde","webpack://vue-flatsurf/./src/components/FlowComponent.vue?bd31","webpack://vue-flatsurf/./src/Palette.ts","webpack://vue-flatsurf/./src/Progress.ts","webpack://vue-flatsurf/./src/CancellationToken.ts","webpack://vue-flatsurf/./src/geometry/layout/CellLayout.ts","webpack://vue-flatsurf/./src/geometry/layout/FlatTriangulationLayout.ts","webpack://vue-flatsurf/./src/export/SVGExporter.ts","webpack://vue-flatsurf/./src/components/Surface.vue","webpack://vue-flatsurf/./src/components/Surface.vue?3189","webpack://vue-flatsurf/./src/components/Surface.vue?94ad","webpack://vue-flatsurf/./src/components/SurfaceViewer.vue","webpack://vue-flatsurf/./src/components/SurfaceViewer.vue?1ac1","webpack://vue-flatsurf/./src/components/SurfaceViewer.vue?3274","webpack://vue-flatsurf/./demo/2-3-4-pullback-flow.txt","webpack://vue-flatsurf/./demo/Overlay.vue?86db","webpack://vue-flatsurf/./demo/Overlay.vue","webpack://vue-flatsurf/./demo/Overlay.vue?3854","webpack://vue-flatsurf/./demo/Overlay.vue?d4f7","webpack://vue-flatsurf/./demo/App.vue","webpack://vue-flatsurf/./demo/App.vue?2c48","webpack://vue-flatsurf/./demo/App.vue?7ebf","webpack://vue-flatsurf/./demo/main.ts","webpack://vue-flatsurf/webpack/bootstrap","webpack://vue-flatsurf/webpack/runtime/chunk loaded","webpack://vue-flatsurf/webpack/runtime/compat get default export","webpack://vue-flatsurf/webpack/runtime/define property getters","webpack://vue-flatsurf/webpack/runtime/global","webpack://vue-flatsurf/webpack/runtime/hasOwnProperty shorthand","webpack://vue-flatsurf/webpack/runtime/make namespace object","webpack://vue-flatsurf/webpack/runtime/jsonp chunk loading","webpack://vue-flatsurf/webpack/startup"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","overlay","progress","raw","on","onError","svg","svgExport","scopedSlots","_u","key","fn","ref","_g","_b","error","_v","model","value","callback","$$v","editor","expression","$event","staticClass","_e","staticRenderFns","class","pan","onMouseDown","onMouseUp","_t","viewport","Point","parent","x","y","equalTo","rhs","epsilon","Math","abs","embed","toString","shape","translate","vector","Box","xy0","xy1","console","assert","Array","min","max","shapes","length","Error","boxes","map","box","reduce","a","b","merge","contain","aspectRatio","xmin","height","width","ymin","xmax","ymax","other","toPoints","point","low","high","Polygon","face","addFace","convexHull","vertices","points","coordinateSystem","p","some","hull","q","last","next","leftTo","push","pop","polygon","minArea","minAreaRect","edge","edges","segment","direction","tangentInStart","theta","angleTo","rotation","cos","sin","aligned","transform","area","CoordinateSystem","inverse","vertex","faces","start","lfaces","rfaces","lface","rface","rot","keys","every","i","rindex","findIndex","splice","positive","reverse","Vector","yaml","rotate90CW","rotate90CCW","normalize","multiply","scalar","ccw","invert","add","v","Segment","end","undefined","middle","tangentInEnd","at","relative","delta","intersect","intersections","intersects","touch","Line","pt","norm","intersection","A","a00","a01","a02","a10","a11","a12","a20","a21","a22","c","tx","d","ty","adj","det","inv","affine","embeddedInto","embedding","embedInto","into","JSON","stringify","origin","Viewport","ideal","idealCoordinateSystem","viewportCoordinateSystem","visible","focused","resize","focus","zoom","factor","center","centerBefore","centerAfter","PanZoom","observer","ResizeObserver","unpanzoom","$refs","clientWidth","window","innerWidth","clientHeight","innerHeight","refocus","mounted","$el","panzoom","observe","beforeDestroy","unobserve","e","dz","exp","dx","dy","required","type","immediate","component","surface","automorphisms","components","inner","onLayoutChanged","onSVGChanged","Permutation","cycles","mapping","cycle","fromMapping","entry","String","xor","Object","find","includes","image","preimage","values","FlatTriangulation","fromCycles","fromEntries","entries","vectors","halfEdge","parse","halfEdges","domain","he","Number","sum","Automorphism","set","hasOwnProperty","halfEdgeMap","orbit","automorphism","SaddleConnection","source","target","crossings","freeze","FlowConnection","vertical","boundary","touches","connection","FlowComponent","cylinder","perimeter","inside","layout","_l","palette","color","sourceIndicators","Ngon","xy","join","Face","onClick","onMouseEnter","onMouseLeave","onMouseMove","halfEdgeConfiguration","state","_s","label","indicator","selected","glued","coords","embedded","transformation","HalfEdgeLabel","midpoint","normal","position","x1","y1","x2","y2","atEnd","SVGArrow","endWithoutHead","PI","preventDefault","stopPropagation","$emit","apply","arguments","script","DefaultHalfEdgeConfiguration","interactions","click","enter","leave","hover","HalfEdgeComponent","sourceIndicator","ev","Boolean","default","Arrow","ExtendedClickArea","SegmentComponent","SegmentLabel","filter","primary","s","t","w","angle","degree","style","segments","crossing","shift","line","crossingEdge","crossingLine","alongHalfEdge","ats","resetCaches","ensureCaches","index","floor","patch","isHalfEdge","B","C","scenario","atouches","btouches","patchHalfEdge","triangles","patches","glue","ngon","triangle","step","n","nn","SaddleConnectionComponent","Palette","constructor","colors","space","seed","colorSpace","warn","Progress","name","steps","task","OperationAborted","CancellationToken","cancellationRequested","Promise","resolve","reject","aborted","setTimeout","cancelled","cancel","abort","CellLayout","cell","boundingRectArea","boundingRect","before","glues","otherPolygon","touchConsistent","boundaries","side","pending","Set","size","delete","cells","force","cache","cancellation","_progress","scores","score","best","minBy","ca","cb","dc","x00","x01","x02","x10","x11","x12","x20","x21","x22","delaunay","ungluedArea","gluedArea","isArray","packed","cell_","halfEdge_","packable","segment_","screen","FlatTriangulationLayout","recompute","_","pack","assign","flat","log","bbox","SVGExporter","cloneNode","styles","getElementsByTagName","computedStyle","tagName","document","createElement","appendChild","unshift","setAttribute","element","getComputedStyle","computed","getPropertyValue","children","dropClasses","child","removeAttribute","dropPrefixedStyles","_value","startsWith","dropInvisible","trash","addToTrash","forEach","_style","parentNode","removeChild","dropRedundantStyles","dropCustomAttributes","attributes","attribute","dropNonStandardStyles","standard","usePresentationAttributes","makePresentation","hasAttribute","simplifyColors","simplify","okey","getAttribute","opacity","dropTrivialStyles","dropNonInkscapeStyles","dropInteractiveStyles","inlineStyles","svgo","outerHTML","data","Surface","forced","hovered","visibleComponents","defaultLabel","run","created","relayout","nextLabel","chars","split","charCodeAt","code","fromCharCode","async","componentInnerHalfEdges","cylinderInnerHalfEdges","$nextTick","exporter","onForcedChanged","onInnerChanged","forceHalfEdge","$once","clamp","unhover","relativizeOntoSegment","toPoint","dot","clientX","getBoundingClientRect","left","clientY","top","from","_run","FlatTriangulationComponent","FlowComponentComponent","SurfaceViewer","onRawChanged","parsed","rotatedCoordinateSystem","rotate","message","Overlay","onCancellation","stats","VBtn","App","VApp","h","vuetify","$mount","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","module","__webpack_modules__","call","m","deferred","O","result","chunkIds","priority","notFulfilled","Infinity","fulfilled","j","r","getter","__esModule","definition","o","defineProperty","enumerable","get","g","globalThis","Function","obj","prop","prototype","Symbol","toStringTag","installedChunks","chunkId","webpackJsonpCallback","parentChunkLoadingFunction","moreModules","runtime","chunkLoadingGlobal","self","bind","__webpack_exports__"],"mappings":"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","file":"js/app-legacy.2c762616.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-app',[_c('v-main',[_c('v-container',{attrs:{\"fluid\":\"\",\"fill-height\":\"\"}},[_c('overlay',{attrs:{\"cancellation\":_vm.overlay,\"progress\":_vm.progress}}),_c('surface-viewer',{attrs:{\"raw\":_vm.raw},on:{\"error\":_vm.onError,\"ok\":function () { return _vm.onError(); },\"svg\":function (svg) { return _vm.svgExport = svg; }}})],1),_c('v-dialog',{attrs:{\"fullscreen\":\"\",\"hide-overlay\":\"\",\"transition\":\"dialog-bottom-transition\"},scopedSlots:_vm._u([{key:\"activator\",fn:function(ref){\nvar on = ref.on;\nvar attrs = ref.attrs;\nreturn [_c('v-btn',_vm._g(_vm._b({attrs:{\"color\":_vm.error ? 'red': 'green',\"dark\":\"\",\"dense\":\"\",\"small\":\"\",\"fixed\":\"\",\"bottom\":\"\",\"right\":\"\",\"fab\":\"\"}},'v-btn',attrs,false),on),[(!_vm.error)?_c('v-icon',[_vm._v(\"mdi-pencil\")]):_c('v-icon',[_vm._v(\"mdi-alert-circle-outline\")])],1)]}}]),model:{value:(_vm.editor),callback:function ($$v) {_vm.editor=$$v},expression:\"editor\"}},[_c('v-card',[_c('v-toolbar',{attrs:{\"dark\":\"\",\"cards\":\"\",\"color\":_vm.error ? 'red' : 'green'}},[_c('v-btn',{attrs:{\"icon\":\"\",\"dark\":\"\"},on:{\"click\":function($event){_vm.editor = false}}},[_c('v-icon',[_vm._v(\"mdi-arrow-left\")])],1),_c('v-card-title',[_vm._v(\"Flat Triangulation Data\")])],1),_c('v-form',{staticClass:\"pa-6 pt-6\"},[_c('v-textarea',{staticClass:\"editor\",attrs:{\"error-messages\":_vm.error,\"auto-grow\":\"\",\"filled\":\"\",\"rows\":\"1\"},model:{value:(_vm.raw),callback:function ($$v) {_vm.raw=$$v},expression:\"raw\"}})],1)],1)],1),(!_vm.error && !_vm.overlay)?_c('v-dialog',{attrs:{\"fullscreen\":\"\",\"hide-overlay\":\"\",\"transition\":\"dialog-bottom-transition\"},scopedSlots:_vm._u([{key:\"activator\",fn:function(ref){\nvar on = ref.on;\nvar attrs = ref.attrs;\nreturn [_c('v-btn',_vm._g(_vm._b({attrs:{\"color\":\"blue\",\"dark\":\"\",\"dense\":\"\",\"small\":\"\",\"fixed\":\"\",\"bottom\":\"\",\"left\":\"\",\"fab\":\"\"}},'v-btn',attrs,false),on),[_c('v-icon',[_vm._v(\"mdi-camera\")])],1)]}}],null,false,4025757055),model:{value:(_vm.svg),callback:function ($$v) {_vm.svg=$$v},expression:\"svg\"}},[_c('v-card',[_c('v-toolbar',{attrs:{\"dark\":\"\",\"cards\":\"\",\"color\":\"green\"}},[_c('v-btn',{attrs:{\"icon\":\"\",\"dark\":\"\"},on:{\"click\":function($event){_vm.svg = false}}},[_c('v-icon',[_vm._v(\"mdi-arrow-left\")])],1),_c('v-card-title',[_vm._v(\"SVG Export\")])],1),_c('v-form',{staticClass:\"pa-6 pt-6\"},[_c('v-textarea',{staticClass:\"editor\",attrs:{\"auto-grow\":\"\",\"filled\":\"\",\"rows\":\"1\"},model:{value:(_vm.svgExport),callback:function ($$v) {_vm.svgExport=$$v},expression:\"svgExport\"}})],1)],1)],1):_vm._e()],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{ref:\"viewport\",class:{ pan: _vm.pan },on:{\"mousedown\":_vm.onMouseDown,\"mouseup\":_vm.onMouseUp}},[_vm._t(\"default\",null,{\"viewport\":_vm.viewport})],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","/* ******************************************************************************\n * Copyright (c) 2020 Julian Rüth <julian.rueth@fsfe.org>\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n * *****************************************************************************/\n\nimport Flatten from \"@flatten-js/core\";\n\nimport CoordinateSystem, { Coordinate } from \"./CoordinateSystem\";\nimport Vector from './Vector';\nimport Polygon from './Polygon';\nimport Segment from './Segment';\n\nexport default class Point {\n  public constructor(parent: CoordinateSystem, x: Coordinate, y: Coordinate);\n  public constructor(parent: CoordinateSystem, p: Flatten.Point);\n  public constructor(parent: CoordinateSystem, x: Coordinate | Flatten.Point, y?: Coordinate) {\n    this.parent = parent;\n    if (typeof(x) === \"number\")\n      this.value = new Flatten.Point(x, y);\n    else\n      this.value = x;\n  }\n  \n  public get x() { return this.value.x; }\n  public get y() { return this.value.y; }\n  public get xy() : [Coordinate, Coordinate] { return [this.x, this.y]; }\n\n  public equalTo(rhs: Point, epsilon: number = 0): boolean {\n    if (this.parent === rhs.parent)\n      return Math.abs(this.x - rhs.x) <= epsilon && Math.abs(this.y - rhs.y) <= epsilon;\n    return this.parent.embed(rhs).equalTo(this);\n  }\n\n  public toString(): string {\n    return `(${this.x}, ${this.y})`;\n  }\n\n  public on(shape: Polygon): boolean;\n  public on(shape: Segment): boolean;\n  public on(shape: Polygon | Segment): boolean {\n    return shape.parent.embed(this).value.on(shape.value);\n  }\n\n  public translate(vector: Vector): Point {\n    return new Point(this.parent, this.value.translate(this.parent.embed(vector).value));\n  }\n\n  public readonly parent: CoordinateSystem;\n  public readonly value: Flatten.Point;\n}\n","/* ******************************************************************************\n * Copyright (c) 2020 Julian Rüth <julian.rueth@fsfe.org>\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n * *****************************************************************************/\n\nimport Flatten from \"@flatten-js/core\";\n\nimport CoordinateSystem, { Coordinate } from \"./CoordinateSystem\";\nimport Point from \"./Point\";\nimport Segment from './Segment';\n\nexport default class Box {\n  public constructor(parent: CoordinateSystem, box: Flatten.Box);\n  public constructor(parent: CoordinateSystem, xy0: [Coordinate, Coordinate], xy1: [Coordinate, Coordinate]);\n  public constructor(parent: CoordinateSystem, xy0: [Coordinate, Coordinate] | Flatten.Box, xy1?: [Coordinate, Coordinate]) {\n    this.parent = parent;\n\n    if (xy0 instanceof Flatten.Box) {\n      this.value = xy0;\n    } else {\n      console.assert(xy1 instanceof Array);\n      this.value = new Flatten.Box(Math.min(xy0[0], xy1![0]), Math.min(xy0[1], xy1![1]), Math.max(xy0[0], xy1![0]), Math.max(xy0[1], xy1![1]));\n    }\n  }\n\n  public static bbox(shapes: Array<Point|Segment>): Box {\n    if (shapes.length === 0)\n      throw Error(\"cannot create bounding box of nothing\");\n\n    const boxes = shapes.map((shape) => {\n      if (shape instanceof Point)\n        return new Box(shape.parent, [shape.value.x, shape.value.y], [shape.value.x, shape.value.y]);\n      else\n        return new Box(shape.parent, shape.value.box);\n    });\n    return boxes.reduce((a: Box, b: Box) => a.merge(b));\n  }\n\n  // Return an enlargened version of this box that has the prescribed aspect\n  // ratio (leaving one of its dimensions untouched and centering it in the\n  // other dimension.)\n  public contain(aspectRatio: number) {\n    if (this.aspectRatio < aspectRatio)\n      return new Box(this.parent, [this.value.xmin - (this.height * aspectRatio - this.width) / 2, this.value.ymin], [this.value.xmax + (this.height * aspectRatio - this.width) / 2, this.value.ymax]);\n    else\n      return new Box(this.parent, [this.value.xmin, this.value.ymin - (this.width / aspectRatio - this.height) / 2], [this.value.xmax, this.value.ymax + (this.width / aspectRatio - this.height) / 2]);\n  }\n\n  public merge(other: Box): Box {\n    return new Box(this.parent, this.value.merge(this.parent.embed(other).value.box));\n  }\n\n  public translate(x: Coordinate, y: Coordinate) {\n    return new Box(this.parent, [this.value.xmin + x, this.value.ymin + y], [this.value.xmax + x, this.value.ymax + y]);\n  }\n\n  public get low() {\n    return new Point(this.parent, this.value.xmin, this.value.ymin);\n  }\n\n  public get high() {\n    return new Point(this.parent, this.value.xmax, this.value.ymax);\n  }\n\n  public get aspectRatio() {\n    return this.width / this.height;\n  }\n\n  public get width() {\n    return this.value.xmax - this.value.xmin;\n  }\n\n  public get center() {\n    return new Point(this.parent, (this.value.xmin + this.value.xmax) / 2, (this.value.ymin + this.value.ymax) / 2);\n  }\n\n  public get height() {\n    return this.value.ymax - this.value.ymin;\n  }\n\n  public toPoints() {\n    return this.value.toPoints().map((point) => new Point(this.parent, point));\n  }\n\n  public equalTo(rhs: Box, epsilon: number = 0): boolean {\n    if (this.parent === rhs.parent)\n      return this.low.equalTo(rhs.low, epsilon) && this.high.equalTo(rhs.high, epsilon);\n    return this.parent.embed(rhs).box.equalTo(this);\n  }\n\n  public readonly parent: CoordinateSystem;\n  public readonly value: Flatten.Box;\n}\n","/* ******************************************************************************\n * Copyright (c) 2020 Julian Rüth <julian.rueth@fsfe.org>\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n * *****************************************************************************/\n\nimport Flatten from \"@flatten-js/core\";\n\nimport findIndex from \"lodash-es/findIndex\";\n\nimport CoordinateSystem from \"./CoordinateSystem\";\nimport Point from \"./Point\";\nimport Box from \"./Box\";\n\nexport default class Polygon {\n  public constructor(parent: CoordinateSystem, value: Point[][]);\n  public constructor(parent: CoordinateSystem, value: Flatten.Polygon);\n  public constructor(parent: CoordinateSystem, value: Flatten.Polygon | Point[][]) {\n    this.parent = parent;\n    if (value instanceof Flatten.Polygon) {\n      this.value = value;\n    } else if (value instanceof Array) {\n      this.value = new Flatten.Polygon();\n      for (const face of value) {\n        this.value.addFace(face.map((point) => parent.embed(point).value));\n      }\n    } else {\n      throw Error(\"Cannot create polygon from this data.\");\n    }\n  }\n\n  public get convexHull(): Polygon {\n    return Polygon.convexHull(this.vertices);\n  }\n\n  // Compute the convex hull of the points (using the slow Jarvis march\n  // algorithm.)\n  public static convexHull(points: Point[]): Polygon {\n    console.assert(points.length !== 0);\n\n    const coordinateSystem = points[0].parent;\n\n    const vertices = points.map((p) => coordinateSystem.embed(p).value);\n\n    console.assert(vertices.some((p) => !p.equalTo(vertices[0])));\n\n    const hull = [vertices.reduce((p, q) => {\n      if (p.x < q.x)\n        return p;\n      if (p.x > q.x)\n        return q\n      if (p.y < q.y)\n        return p;\n      return q;\n    })];\n\n    do {\n      const last = hull[hull.length - 1];\n      let next = vertices[0].equalTo(last) ? vertices[1] : vertices[0];\n      for (let p of vertices) {\n        if (p.leftTo(new Flatten.Line(last, next)))\n          next = p;\n      }\n      hull.push(next);\n      // TODO: This is numerically too unstable (and hangs sometimes.)\n      if (hull.length > vertices.length + 1) {\n        console.error(\"Convex Hull incorrect\");\n        break;\n      }\n    } while(!hull[hull.length - 1].equalTo(hull[0]));\n\n    hull.pop();\n\n    const polygon = new Flatten.Polygon();\n    polygon.addFace(hull);\n    return new Polygon(coordinateSystem, polygon);\n  }\n\n  // Return a bounding rectangle of minimal area. (The rectangle might not be\n  // axis-aligned.)\n  public get boundingRect(): Polygon {\n    const hull = this.convexHull;\n\n    let minArea = 1./0.;\n    let minAreaRect = null;\n\n    // Algorithm: The minimal bounding rect of a convex polygon must be aligned to one of its sides.\n    for (const edge of hull.value.edges) {\n      // Rotate such that the edge is horizontal.\n      const segment: Flatten.Segment = edge.shape;\n      const direction = segment.tangentInStart();\n      const theta = new Flatten.Vector(1, 0).angleTo(direction);\n      const rotation = new Flatten.Matrix(\n        Math.cos(-theta), -Math.sin(-theta),\n        Math.sin(-theta), Math.cos(-theta),\n      );\n      const aligned = hull.value.transform(rotation);\n\n      // Compute the area of this bounding box.\n      const area = aligned.area();\n\n      if (area < minArea) {\n        minArea = area;\n\n        // Rotate the box back.\n        minAreaRect = new Polygon(this.parent, new Flatten.Polygon(aligned.box.toPoints()).transform(CoordinateSystem.inverse(rotation)));\n      }\n    }\n\n    return minAreaRect!;\n  }\n\n  // Return a bounding box of this polygon in its parent's coordinate system.\n  public get box(): Box {\n    return new Box(this.parent, this.value.box);\n  }\n\n  public get vertices(): Point[] {\n    return this.value.vertices.map((vertex) => new Point(this.parent, vertex));\n  }\n\n  public get faces(): Point[][] {\n    const faces = [...this.value.faces] as Flatten.Face[];\n    return faces.map((face) => face.edges.map((edge) => new Point(this.parent, edge.start)));\n  }\n\n  public equalTo(rhs: Box, epsilon?: number): boolean;\n  public equalTo(rhs: Polygon, epsilon?: number): boolean;\n  public equalTo(rhs: Box | Polygon, epsilon: number = 0): boolean {\n    if (rhs instanceof Polygon) {\n      const lfaces = this.faces;\n      const rfaces = rhs.faces;\n\n      if (lfaces.length !== rfaces.length)\n        return false;\n\n      const equalTo = (lface: Point[], rface: Point[]) => {\n        if (lface.length !== rface.length)\n          return false;\n        for (let rot = 0; rot < lface.length; rot++) {\n          if ([...lface.keys()].every((i) => lface[i].equalTo(rface[(i + rot) % rface.length], epsilon)))\n            return true;\n        }\n        return false;\n      };\n\n      for (const lface of lfaces) {\n        const rindex = findIndex(rfaces, (rface) => equalTo(lface, rface));\n        if (rindex === -1)\n          return false;\n        rfaces.splice(rindex, 1);\n      }\n\n      return true;\n    } else {\n      const points = rhs.toPoints();\n      if (this.parent.positive === rhs.parent.positive)\n        points.reverse();\n      return this.equalTo(new Polygon(this.parent, [points]), epsilon);\n    }\n  }\n\n  public area(): number {\n    return this.value.area();\n  }\n  \n  public readonly parent: CoordinateSystem;\n  public readonly value: Flatten.Polygon;\n}\n","/* ******************************************************************************\n * Copyright (c) 2020 Julian Rüth <julian.rueth@fsfe.org>\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n * *****************************************************************************/\n\nimport Flatten from \"@flatten-js/core\";\n\nimport CoordinateSystem, { Coordinate } from \"./CoordinateSystem\";\nimport Point from './Point';\n\nexport interface VectorSchema {\n  x: number,\n  y: number,\n};\n\nexport default class Vector {\n  public constructor(parent: CoordinateSystem, x: Coordinate, y: Coordinate);\n  public constructor(parent: CoordinateSystem, p: Flatten.Vector);\n  public constructor(parent: CoordinateSystem, a: Point, b: Point);\n  public constructor(parent: CoordinateSystem, x: Coordinate | Flatten.Vector | Point, y?: Coordinate | Point) {\n    this.parent = parent;\n    if (typeof(x) === \"number\" && typeof(y) === \"number\") {\n      this.value = new Flatten.Vector(x, y);\n    } else if (x instanceof Flatten.Vector && y == null) {\n      this.value = x;\n    } else if (x instanceof Point && y instanceof Point) {\n      const a = parent.embed(x);\n      const b = parent.embed(y);\n      this.value = new Flatten.Vector(a.value, b.value);\n    } else\n      throw Error(\"Cannot initialize Vector from this data.\");\n  }\n\n  public static parse(yaml: VectorSchema, coordinateSystem: CoordinateSystem): Vector {\n    return new Vector(coordinateSystem, yaml.x, yaml.y);\n  }\n  \n  public get x() { return this.value.x; }\n  public get y() { return this.value.y; }\n  public get xy() : [Coordinate, Coordinate] { return [this.x, this.y]; }\n\n  public rotate90CW() {\n    return new Vector(this.parent, this.parent.positive ? this.value.rotate90CW(): this.value.rotate90CCW());\n  }\n\n  public rotate90CCW() {\n    return new Vector(this.parent, this.parent.positive ? this.value.rotate90CCW(): this.value.rotate90CW());\n  }\n\n  public normalize() {\n    return new Vector(this.parent, this.value.normalize());\n  }\n\n  public multiply(scalar: number) {\n    return new Vector(this.parent, this.value.multiply(scalar));\n  }\n\n  public angleTo(ccw: Vector) {\n    return this.parent.positive ? this.parent.embed(ccw).value.angleTo(this.value) : this.value.angleTo(this.parent.embed(ccw).value);\n  }\n\n  public invert() {\n    return new Vector(this.parent, this.value.invert());\n  }\n\n  public add(v: Vector) {\n    return new Vector(this.parent, this.value.add(this.parent.embed(v).value));\n  }\n\n  public equalTo(rhs: Vector, epsilon: number = 0): boolean {\n    if (this.parent === rhs.parent)\n      return Math.abs(this.x - rhs.x) <= epsilon && Math.abs(this.y - rhs.y) <= epsilon;\n    return this.parent.embed(rhs).equalTo(this);\n  }\n\n  public readonly parent: CoordinateSystem;\n  public readonly value: Flatten.Vector;\n}\n\n\n","/* ******************************************************************************\n * Copyright (c) 2020 Julian Rüth <julian.rueth@fsfe.org>\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n * *****************************************************************************/\n\nimport Flatten from \"@flatten-js/core\";\n\nimport CoordinateSystem from \"./CoordinateSystem\";\nimport Point from \"./Point\";\nimport Polygon from './Polygon';\nimport Vector from './Vector';\n\nexport default class Segment {\n  public constructor(start: Point, end: Point);\n  public constructor(parent: CoordinateSystem, value: Flatten.Segment);\n  public constructor(parent: CoordinateSystem, start: Flatten.Point, end: Flatten.Point);\n  public constructor(parent: CoordinateSystem | Point, value: Point | Flatten.Point | Flatten.Segment, end?: Flatten.Point){\n    if (!(parent instanceof CoordinateSystem)) {\n      console.assert(value instanceof Point, value);\n      ({parent, value, end} = {\n        parent: parent.parent,\n        value: parent.value,\n        end: parent.parent.embed(value as Point).value,\n      });\n    }\n\n    this.parent = parent;\n    if (end !== undefined) {\n      const start = value as Flatten.Point;\n      this.value = new Flatten.Segment(start, end);\n    } else {\n      this.value = value as Flatten.Segment;\n    }\n  }\n  \n  public get start() { return new Point(this.parent, this.value.start); }\n  public get middle() { return new Point(this.parent, this.value.middle()); }\n  public get end() { return new Point(this.parent, this.value.end); }\n  public get tangentInStart() { return new Vector(this.parent, this.value.tangentInStart()); }\n  public get tangentInEnd() { return new Vector(this.parent, this.value.tangentInEnd()); }\n\n  public at(relative: number) {\n    return this.start.translate(new Vector(this.parent, this.start, this.end).multiply(relative));\n  }\n\n  public translate(delta: Vector): Segment {\n    delta = this.parent.embed(delta);\n    return new Segment(this.parent, this.value.translate(delta.value));\n  }\n\n  // Return the points of intersection between this segment and the segments\n  // forming the boundary of the polygon. If this segment overlaps with one of\n  // the boundary segments, the end points of the overlap are included. If it\n  // touches, the point of touching is included.\n  public intersect(shape: Polygon): Point[] {\n    const intersections = shape.parent.embed(this).value.intersect(shape.value).map(value => new Point(shape.parent, value));\n    if(this.start.on(shape))\n      // TODO: Bug in flatten.\n      intersections.push(this.start);\n    if (this.end.on(shape))\n      // TODO: Bug in flatten.\n      intersections.push(this.end);\n    return intersections;\n  }\n\n  // Return whether this segment and the (filled) shape have at least one point\n  // in common.\n  public intersects(shape: Polygon): boolean {\n    return Flatten.Relations.intersect(shape.parent.embed(this).value, shape.value);\n  }\n\n  public touch(shape: Polygon): boolean {\n    return Flatten.Relations.touch(shape.parent.embed(this).value, shape.value);\n  }\n\n  public toString(): string {\n    return `((${this.value.start.x}, ${this.value.start.y}), (${this.value.end.x}, ${this.value.end.y}))`;\n  }\n\n  public get length() {\n    return this.value.length;\n  }\n\n  public equalTo(rhs: Segment, epsilon: number = 0): boolean {\n    return this.start.equalTo(rhs.start, epsilon) && this.end.equalTo(rhs.end, epsilon);\n  }\n\n  public reverse(): Segment {\n    return new Segment(this.parent, this.value.reverse());\n  }\n\n  public readonly parent: CoordinateSystem;\n  public readonly value: Flatten.Segment;\n}\n","/* ******************************************************************************\n * Copyright (c) 2020 Julian Rüth <julian.rueth@fsfe.org>\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n * *****************************************************************************/\n\nimport Flatten from \"@flatten-js/core\";\n\nimport Point from \"./Point\";\nimport Vector from \"./Vector\";\nimport CoordinateSystem from \"./CoordinateSystem\";\n\nexport default class Line {\n  constructor(pt: Point, norm: Vector);\n  constructor(a: Point, b: Point);\n  public constructor(pt: Point, norm: Point | Vector) {\n    this.parent = pt.parent;\n    if (norm instanceof Point)\n      this.value = new Flatten.Line(pt.value, this.parent.embed(norm).value);\n    else\n      this.value = new Flatten.Line(pt.value, this.parent.embed(norm).value);\n  }\n\n  public intersect(other: Line): Point | null {\n    const intersections = other.parent.embed(this).value.intersect(other.value).map((intersection) => new Point(other.parent, intersection));\n    if (intersections.length === 0) return null;\n    if (intersections.length !== 1) throw Error(\"not implemented: Line.intersection()\");\n    return intersections[0];\n  }\n\n  public get pt() { return new Point(this.parent, this.value.pt); }\n  public get norm() { return new Vector(this.parent, this.value.norm); }\n\n  public readonly parent: CoordinateSystem;\n  public readonly value: Flatten.Line;\n}\n","/* ******************************************************************************\n * Copyright (c) 2020 Julian Rüth <julian.rueth@fsfe.org>\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n * *****************************************************************************/\n\nimport Flatten from \"@flatten-js/core\";\n\nimport Point from \"./Point\";\nimport Polygon from \"./Polygon\";\nimport Box from \"./Box\";\nimport Vector from \"./Vector\";\nimport Segment from \"./Segment\";\nimport Line from \"./Line\";\n\nexport type Coordinate = number;\n\nexport default class CoordinateSystem {\n  public constructor(positive: boolean) {\n    this.positive = positive;\n  }\n\n  public static inverse(A: Flatten.Matrix) {\n    const [a00, a01, a02, a10, a11, a12, a20, a21, a22] = [A.a, A.c, A.tx, A.b, A.d, A.ty, 0, 0, 1];\n    const adj = [a11*a22 - a21*a12, a10*a22 - a20*a12, a10*a21 - a20*a11, a01*a22 - a21*a02, a00*a22 - a20*a02, a00*a21 - a20*a01, a01*a12 - a11*a02, a00*a12 - a10*a02, a00*a11 - a10*a01];\n    const det = a00*adj[0] - a01*adj[1] + a02*adj[2];\n    const inv = [adj[0], -adj[3], adj[6], -adj[1], adj[4], -adj[7], adj[2], -adj[5], adj[8]].map(a => a / det);\n    const affine = inv.map(a => a / inv[8]);\n    return new Flatten.Matrix(affine[0], affine[3], affine[1], affine[4], affine[2], affine[5]);\n  }\n\n  public readonly positive: boolean;\n  private embeddedInto: CoordinateSystem | null = null;\n  private embedding: Flatten.Matrix | null = null;\n\n  public embedInto(into: CoordinateSystem, embedding?: Flatten.Matrix) {\n    if (embedding === undefined) {\n      embedding = new Flatten.Matrix();\n      if (this.positive !== into.positive)\n        embedding = new Flatten.Matrix(1, 0, 0, -1);\n    }\n    if (this.embeddedInto !== null && this.embeddedInto !== into)\n        throw Error(\"not implemented: cannot have more than one embedding but this coordinate system is already embedded into another one\")\n    this.embeddedInto = into;\n    this.embedding = embedding;\n  }\n\n  public box(xy0: [Coordinate, Coordinate], xy1: [Coordinate, Coordinate]) {\n    return new Box(this, xy0, xy1);\n  }\n\n  public point(x: Coordinate, y: Coordinate) {\n    return new Point(this, x, y);\n  }\n\n  public embed(box: Box): Polygon;\n  public embed(point: Point): Point;\n  public embed(vector: Vector): Vector;\n  public embed(segment: Segment): Segment;\n  public embed(line: Line): Line;\n  public embed(polygon: Polygon): Polygon;\n  public embed(value: Box | Point | Vector | Segment | Line | Polygon) : Point | Vector | Segment | Line | Polygon {\n    if (value instanceof Box) {\n      const polygon = new Flatten.Polygon();\n      polygon.addFace(value.toPoints().map((point) => this.embed(point).value));\n      return new Polygon(this, polygon);\n    } else if (value instanceof Point) {\n      let point = value as Point;\n      while(true) {\n        if (this === point.parent)\n          return point;\n\n        if (point.parent.embeddedInto === null)\n          break;\n\n        point = new Point(point.parent.embeddedInto,\n          point.value.transform(point.parent.embedding!));\n      }\n\n      if (this.embeddedInto === null) {\n        throw Error(`point (${point.value.x}, ${point.value.y}) cannot be embedded from coordinate system ${JSON.stringify(point.parent)} into this coordinate system ${JSON.stringify(this)}; no relation between the coordinate systems could be established.`)\n      }\n\n      point = this.embeddedInto.embed(point);\n\n      return new Point(this, ...CoordinateSystem.inverse(this.embedding!).transform([point.x, point.y]));\n    } else if (value instanceof Vector) {\n      const point = this.embed(new Point(value.parent, value.x, value.y));\n      const origin = this.embed(new Point(value.parent, 0, 0));\n      return new Vector(this, point.x - origin.x, point.y - origin.y);\n    } else if (value instanceof Segment) {\n      return new Segment(this, this.embed(value.start).value, this.embed(value.end).value);\n    } else if (value instanceof Line) {\n      return new Line(this.embed(value.pt), this.embed(value.norm));\n    } else if (value instanceof Polygon) {\n      return new Polygon(this, new Flatten.Polygon(([...value.value.faces] as Flatten.Face[]).map((face) => (face.edges as Flatten.Edge[]).map((edge) => this.embed(new Point(value.parent, edge.start)).value))));\n    }\n\n    throw Error(`cannot embed this type of object into coordinate system yet`);\n  }\n}\n\n\n","/* ******************************************************************************\n * Copyright (c) 2020 Julian Rüth <julian.rueth@fsfe.org>\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n * *****************************************************************************/\n\nimport Flatten from \"@flatten-js/core\";\n\nimport CoordinateSystem from \"./CoordinateSystem\";\nimport Box from \"./Box\";\nimport Polygon from \"./Polygon\";\nimport Point from \"./Point\";\n\nexport default class Viewport {\n  public constructor(ideal?: CoordinateSystem, width: number = 640, height: number = 640) {\n    this.idealCoordinateSystem = ideal || new CoordinateSystem(true);\n    if (!this.idealCoordinateSystem.positive)\n      throw new Error(\"ideal coordinate system must be positive\");\n    this.viewportCoordinateSystem = new CoordinateSystem(false);\n    this.width = width;\n    this.height = height;\n    this.visible = new Box(this.viewportCoordinateSystem, [0, 0], [width, height]);\n    this.focused = this.visible;\n\n    this.idealCoordinateSystem.embedInto(this.viewportCoordinateSystem);\n  }\n\n  // Resize the viewport while keeping the currently focused box unchanged.\n  public resize(width: number, height: number) {\n    this.width = width;\n    this.height = height;\n\n    this.focus(this.focused);\n  }\n\n  public focus(focused: Box | Polygon) {\n    if (focused instanceof Box)\n      this.focused = this.idealCoordinateSystem.embed(focused).box;\n    else\n      this.focused = this.idealCoordinateSystem.embed(focused).box;\n    this.visible = this.focused.contain(this.width / this.height);\n    // We now need to embed the \"ideal\" coordinate system into the actual\n    // \"viewport\" coordinate system so that the \"visible\" box fills the (0,\n    // 0), (width, height) box.\n    this.idealCoordinateSystem.embedInto(this.viewportCoordinateSystem, new Flatten.Matrix(\n      this.width / this.visible.width, 0,\n      0, -this.height / this.visible.height,\n      -this.visible.low.x * this.width / this.visible.width,\n      this.visible.high.y * this.height / this.visible.height,\n    ));\n  }\n\n  public zoom(factor: number, center?: Point) {\n    if (center === undefined) {\n      center = this.viewport.center;\n      center = this.focused.parent.embed(center);\n\n      const width = this.focused.width / factor;\n      const height = this.focused.height / factor;\n\n      this.focus(new Box(this.focused.parent,\n        [center.x - width / 2, center.y - height / 2],\n        [center.x + width / 2, center.y + height / 2]));\n    } else {\n      center = this.idealCoordinateSystem.embed(center);\n      const centerBefore = this.viewportCoordinateSystem.embed(center);\n      this.zoom(factor);\n      const centerAfter = this.viewportCoordinateSystem.embed(center);\n      \n      this.focus(this.viewport.translate(centerAfter.x - centerBefore.x, centerAfter.y - centerBefore.y));\n    }\n  }\n\n  public embed(point: Point) : Point;\n  public embed(box: Box) : Polygon;\n  public embed(value: Point | Box) : Point | Polygon {\n    return this.viewportCoordinateSystem.embed(value as any);\n  }\n\n  public get viewport() : Box {\n    return this.viewportCoordinateSystem.embed(this.visible).box;\n  }\n\n  private width: number;\n  private height: number;\n  // The underlying ideal coordinate system that is stable under resizing the\n  // viewport, translating it and such.\n  public readonly idealCoordinateSystem: CoordinateSystem;\n  // Coordinates on screen, i.e., inside the viewport starting at (0, 0) in\n  // the top-left corner.\n  public readonly viewportCoordinateSystem: CoordinateSystem;\n  // The currently focused rectangle, centered in the viewport.\n  private focused: Box;\n  // The currently visible rectangle.\n  private visible: Box;\n};\n","\n\n\n\n\n\nimport { Component, Prop, Vue, Watch } from \"vue-property-decorator\";\nimport Viewport from \"../geometry/Viewport\";\nimport CoordinateSystem from \"../geometry/CoordinateSystem\";\nimport Point from \"../geometry/Point\";\nimport Box from \"../geometry/Box\";\nimport panzoom from \"pan-zoom/index.js\";\n\n@Component\nexport default class PanZoom extends Vue {\n  @Prop({required: true, type: CoordinateSystem}) coordinateSystem!: CoordinateSystem;\n  @Prop({required: true, type: Box}) focus!: Box;\n\n  private observer = new ResizeObserver(this.resize);\n  private unpanzoom = () => {};\n  protected pan = false;\n\n  private resize() {\n    this.viewport.resize(\n      Math.min((this.$refs.viewport as HTMLElement).clientWidth, window.innerWidth),\n      Math.min((this.$refs.viewport as HTMLElement).clientHeight, window.innerHeight));\n  }\n\n  @Watch(\"focus\", {immediate: true})\n  refocus() {\n    this.viewport.focus(this.focus); \n  }\n\n  mounted() {\n    this.unpanzoom = panzoom(this.$el, this.panzoom);\n    this.observer.observe(this.$el);\n    this.resize();\n  }\n\n  beforeDestroy() {\n    this.unpanzoom();\n    this.observer.unobserve(this.$el);\n  }\n\n  onMouseDown() {\n    this.pan = true;\n  }\n\n  onMouseUp() {\n    this.pan = false;\n  }\n\n  get viewport() {\n    return new Viewport(this.coordinateSystem);\n  }\n\n  private panzoom(e: any) {\n    // We either zoom or pan; mixing this is probably confusing.\n    if (e.dz !== 0) {\n      this.viewport.zoom(Math.exp(-e.dz/96), new Point(this.viewport.viewportCoordinateSystem, e.x, e.y));\n    } else {\n      this.viewport.focus(this.viewport.viewport.translate(-e.dx, -e.dy));\n    }\n  }\n}\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??clonedRuleSet-39[0].rules[0].use[0]!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/ts-loader/index.js??clonedRuleSet-39[0].rules[0].use[2]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./PanZoom.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??clonedRuleSet-39[0].rules[0].use[0]!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/ts-loader/index.js??clonedRuleSet-39[0].rules[0].use[2]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./PanZoom.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./PanZoom.vue?vue&type=template&id=43f8a8ee&scoped=true&\"\nimport script from \"./PanZoom.vue?vue&type=script&lang=ts&\"\nexport * from \"./PanZoom.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./PanZoom.vue?vue&type=style&index=0&id=43f8a8ee&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"43f8a8ee\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('pan-zoom',{staticClass:\"surface\",attrs:{\"coordinate-system\":_vm.idealCoordinateSystem,\"focus\":_vm.focus},scopedSlots:_vm._u([{key:\"default\",fn:function(ref){\nvar viewport = ref.viewport;\nreturn [_c('surface',{attrs:{\"viewport\":viewport,\"surface\":_vm.surface,\"automorphisms\":_vm.automorphisms,\"components\":_vm.components,\"inner\":_vm.inner},on:{\"layout\":_vm.onLayoutChanged,\"svg\":_vm.onSVGChanged}})]}}])})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","/* ******************************************************************************\n * Copyright (c) 2020 Julian Rüth <julian.rueth@fsfe.org>\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n * *****************************************************************************/\n\nimport xor from \"lodash-es/xor\";\n\n// A permutation of T where T is something that can be safely converted to a\n// key in an object, i.e., T should probably be number or string.\nexport default class Permutation<T> {\n  public static fromCycles<T>(cycles: Array<T[]>) : Permutation<T> {\n    const mapping = [] as Array<[T, T]>;\n    for (let cycle of cycles)\n      for (let i = 0; i < cycle.length; i++)\n        mapping.push([cycle[i], cycle[(i + 1) % cycle.length]]);\n    return Permutation.fromMapping(mapping);\n  }\n\n  public static fromMapping<T>(mapping: Array<[T, T]>) : Permutation<T> {\n    return new Permutation<T>(mapping);\n  }\n\n  private constructor(mapping: Array<[T, T]>) {\n    this.mapping = {};\n    this.inverse = {};\n\n    for (let entry of mapping) {\n      if (entry[0] in this.mapping)\n        throw Error(`${entry} specified more than once in mapping domain`);\n      if (entry[1] in this.inverse)\n        throw Error(`${entry} specified more than once in mapping codomain`);\n      this.mapping[String(entry[0])] = entry[1];\n      this.inverse[String(entry[1])] = entry[0];\n    }\n\n    if (xor(Object.keys(this.mapping), Object.keys(this.inverse)).length !== 0)\n      throw Error(`domain {${Object.keys(this.mapping)}} and codomain {${Object.keys(this.inverse)}} of permutation are not identical`);\n\n    this.cycles = [];\n    for (let [a, b] of mapping) {\n      if (this.cycles.find((cycle) => cycle.includes(a)))\n        continue;\n      const cycle = [a, b];\n      while(true) {\n        const x = cycle[cycle.length - 1];\n        if (cycle[0] == x) {\n          cycle.pop();\n          break;\n        }\n        cycle.push(this.mapping[String(x)]);\n      }\n      this.cycles.push(cycle);\n    }\n  }\n\n  public image(x: T) {\n    return this.mapping[String(x)];\n  }\n\n  public preimage(x: T) {\n    return this.inverse[String(x)];\n  }\n\n  public get domain() : T[] {\n    return Object.values(this.mapping);\n  }\n\n  public readonly cycles : Array<T[]>;\n\n  private readonly mapping : { [key: string]: T }; \n  private readonly inverse : { [key: string]: T };\n}\n","/* ******************************************************************************\n * Copyright (c) 2020 Julian Rüth <julian.rueth@fsfe.org>\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n * *****************************************************************************/\n\nimport xor from \"lodash-es/xor\";\n\nimport HalfEdge from \"./HalfEdge\";\nimport Permutation from \"./Permutation\";\n\nimport Vector, { VectorSchema } from \"../Vector\";\nimport Point from \"../Point\";\nimport CoordinateSystem from '../CoordinateSystem';\n\nexport interface FlatTriangulationSchema {\n  vertices: Array<HalfEdge[]>,\n  vectors: { [key: number]: VectorSchema }\n};\n\nexport default class FlatTriangulation {\n  public static parse(yaml: FlatTriangulationSchema, coordinateSystem: CoordinateSystem) : FlatTriangulation {\n    return new FlatTriangulation(\n      Permutation.fromCycles(yaml.vertices),\n      Object.fromEntries(Object.entries(yaml.vectors).map(([halfEdge, vector]) => [halfEdge, Vector.parse(vector, coordinateSystem)]))\n    );\n  }\n\n  private constructor(vertices: Permutation<HalfEdge>, vectors: {[key: string]: Vector}) {\n    this.vertices = vertices;\n    this.halfEdges = vertices.domain;\n    this.faces = Permutation.fromMapping(this.halfEdges.map((he) => [-this.vertices.image(he), he]));\n\n    this.vectors = vectors;\n\n    if (xor(\n      [...Object.keys(this.vectors), ...Object.keys(this.vectors).map((he) => String(-Number(he)))],\n      this.halfEdges.map((he) => String(he))\n    ).length !== 0)\n      throw Error(`Provided vectors {${Object.keys(this.vectors)}} and present half edges {${this.halfEdges}} do not coincide.`);\n\n    const coordinateSystem = this.vectors['1'].parent;\n\n    for (const face of this.faces.cycles) {\n      const sum = face.reduce((sum, he) => sum.translate(this.vector(he)), new Point(coordinateSystem, 0, 0));\n      if (!sum.equalTo(new Point(coordinateSystem, 0, 0), 1e-6))\n        throw Error(`Face ${face} is not closed. Going around the face gives (${sum.x}, ${sum.y}) but should be zero.`);\n      // TODO: Wiggle the half edges to a place to make the faces closed in double coordinates.\n    }\n  }\n\n  public vector(halfEdge: HalfEdge): Vector {\n    return this.vectors[halfEdge] || this.vectors[-halfEdge].invert();\n  }\n\n  public readonly vertices: Permutation<HalfEdge>;\n  public readonly halfEdges : HalfEdge[];\n  public readonly faces : Permutation<HalfEdge>;\n  private readonly vectors : {[key: string]: Vector };\n}\n","/* ******************************************************************************\n * Copyright (c) 2021 Julian Rüth <julian.rueth@fsfe.org>\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n * *****************************************************************************/\n\nimport HalfEdge from \"./HalfEdge\";\n\ntype HalfEdgeMap = { [preimage: number]: HalfEdge };\n\nexport interface AutomorphismSchema {\n  halfEdges: HalfEdgeMap,\n};\n\n/*\n * An automorphism of a Flat Triangulation.\n */\nexport default class Automorphism {\n  public static parse(yaml: AutomorphismSchema): Automorphism {\n    return new Automorphism(yaml.halfEdges);\n  }\n\n  private constructor(halfEdges: HalfEdgeMap ) {\n    const set = (preimage: HalfEdge, image: HalfEdge) => {\n      if (halfEdges.hasOwnProperty(preimage))\n        console.assert(halfEdges[preimage] === image);\n      halfEdges[preimage] = image;\n    };\n\n    for (const [key, image] of Object.entries(halfEdges)) {\n      const preimage = Number(key);\n      set(-preimage, -image);\n      set(image, preimage);\n      set(-image, -preimage);\n    }\n\n    this.halfEdgeMap = halfEdges;\n  }\n\n  public static orbit(halfEdge: HalfEdge, automorphisms: Automorphism[]) {\n    const orbit = [halfEdge];\n\n    for (let i = 0; i < orbit.length; i++) {\n      const preimage = orbit[i];\n      for (const automorphism of automorphisms) {\n        const image = automorphism.halfEdgeMap[preimage];\n        if (image != null && !orbit.includes(image))\n          orbit.push(image);\n      }\n    }\n\n    return orbit;\n  }\n\n  // The mapping of half edges under the automorphism.\n  // This mapping might not contain all half edges if the automorphism is only\n  // defined on the level of the Delaunay cells of the triangulation.\n  public readonly halfEdgeMap: HalfEdgeMap;\n}\n\n\n","/* ******************************************************************************\n * Copyright (c) 2021 Julian Rüth <julian.rueth@fsfe.org>\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n * *****************************************************************************/\n\nimport HalfEdge, { HalfEdgeSchema } from \"./HalfEdge\";\nimport Vector, { VectorSchema } from \"../Vector\";\nimport CoordinateSystem from '../CoordinateSystem';\n\nexport interface SaddleConnectionSchema {\n  source: HalfEdgeSchema,\n  target: HalfEdgeSchema,\n  vector: VectorSchema,\n  crossings: {\n    halfEdge: number,\n    at: number,\n  }[]\n};\n\nexport default class SaddleConnection {\n  public static parse(yaml: SaddleConnectionSchema, coordinateSystem: CoordinateSystem): SaddleConnection {\n    return new SaddleConnection(yaml.source, yaml.target, Vector.parse(yaml.vector, coordinateSystem), yaml.crossings);\n  }\n\n  private constructor(source: HalfEdge, target: HalfEdge, vector: Vector, crossings: {halfEdge: HalfEdge, at: number}[]) {\n    this.source = source;\n    this.target = target;\n    this.vector = vector;\n    this.crossings = Object.freeze(crossings);\n  }\n\n  public readonly source: HalfEdge;\n  public readonly target: HalfEdge;\n  public readonly vector: Vector;\n  // The sequence of half edges crossed with approximate\n  // relative point of crossing in [0, 1].\n  public readonly crossings: readonly {halfEdge: HalfEdge, at: number}[];\n}\n\n","/* ******************************************************************************\n * Copyright (c) 2021 Julian Rüth <julian.rueth@fsfe.org>\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n * *****************************************************************************/\n\nimport SaddleConnection, { SaddleConnectionSchema } from \"./SaddleConnection\";\nimport CoordinateSystem from '../CoordinateSystem';\nimport HalfEdge from \"./HalfEdge\";\n\nexport interface Touch {\n  halfEdge: HalfEdge;\n  index: number;\n}\n\nexport interface FlowConnectionSchema extends SaddleConnectionSchema {\n  vertical: boolean;\n  boundary: boolean;\n  touches: Touch[];\n}\n\nexport default class FlowConnection {\n  public static parse(yaml: FlowConnectionSchema, coordinateSystem: CoordinateSystem): FlowConnection {\n    return new FlowConnection(SaddleConnection.parse(yaml, coordinateSystem), yaml.vertical, yaml.boundary, yaml.touches);\n  }\n\n  private constructor(connection: SaddleConnection, vertical: boolean, boundary: boolean, touches: Touch[]) {\n    this.connection = connection;\n    this.vertical = vertical;\n    this.boundary = boundary;\n    this.touches = Object.freeze(touches);\n  }\n\n  public readonly connection: SaddleConnection;\n  public readonly vertical: boolean;\n  public readonly boundary: boolean;\n\n  // The sequence of half edges crossed/touched (most half edges show up in\n  // pairs) and the order of this crossing/touching in comparison to all the\n  // others of this component on that half edge. Typically, starts with\n  // [source half edge, 0], then the first [half edge crossed, 0] if this is\n  // the right-most crossing of that half edge, then [-half edge crossed,\n  // 0], ... until the [target half edge, 0].\n  public readonly touches: readonly Touch[];\n}\n","/* ******************************************************************************\n * Copyright (c) 2021 Julian Rüth <julian.rueth@fsfe.org>\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n * *****************************************************************************/\n\nimport CoordinateSystem from '../CoordinateSystem';\nimport FlowConnection, { FlowConnectionSchema } from \"./FlowConnection\";\nimport HalfEdge, { HalfEdgeSchema } from './HalfEdge';\n\nexport default class FlowComponent {\n  public static parse(yaml: {\n    cylinder: boolean,\n    perimeter: FlowConnectionSchema[],\n    inside: HalfEdgeSchema[],\n  }, coordinateSystem: CoordinateSystem) : FlowComponent {\n    return new FlowComponent(yaml.cylinder, yaml.perimeter.map(connection => FlowConnection.parse(connection, coordinateSystem)), yaml.inside);\n  }\n\n  private constructor(cylinder: boolean, perimeter: FlowConnection[], inside: HalfEdge[]) {\n    this.cylinder = cylinder;\n    this.perimeter = perimeter;\n    this.inside = inside;\n  }\n\n  public readonly cylinder: boolean;\n  public readonly perimeter: FlowConnection[];\n  public readonly inside: HalfEdge[];\n}\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('svg',{ref:\"svg\",attrs:{\"width\":_vm.viewport.width,\"height\":_vm.viewport.height}},[(_vm.layout != null)?_c('flat-triangulation-component',{attrs:{\"surface\":_vm.layout}},[(_vm.layout != null)?_c('g',_vm._l((_vm.visibleComponents),function(component,i){return _c('flow-component-component',{key:i,attrs:{\"color\":_vm.palette.color(i),\"component\":component,\"layout\":_vm.layout,\"surface\":_vm.surface}})}),1):_vm._e()]):_vm._e()],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('g',{staticClass:\"FlatTriangulation\"},[_c('g',_vm._l((_vm.faces),function(face,i){return _c('face',{key:i,attrs:{\"vertices\":face}})}),1),_vm._t(\"default\"),_c('g',_vm._l((_vm.halfEdges),function(halfEdge){return _c('half-edge-component',{key:halfEdge,attrs:{\"inner\":_vm.surface.layout(halfEdge).inner,\"surface\":_vm.surface,\"half-edge\":halfEdge,\"source-indicator\":_vm.sourceIndicators.includes(halfEdge)}})}),1)],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ngon',{attrs:{\"vertices\":_vm.vertices}})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('polygon',{attrs:{\"points\":_vm.points}})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\nimport { Component, Inject, Prop, Vue } from \"vue-property-decorator\";\n\nimport Point from \"@/geometry/Point\";\n\n@Component\nexport default class Ngon extends Vue {\n  @Prop({ required: true, type: Array }) vertices!: Point[];\n\n  get points() {\n    return this.vertices.map((xy) => {\n      xy = this.svg(xy); \n      return `${xy.x},${xy.y}`;\n    }).join(\",\");\n  }\n\n  @Inject()\n  svg!: (xy: Point) => Point;\n}\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??clonedRuleSet-39[0].rules[0].use[0]!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/ts-loader/index.js??clonedRuleSet-39[0].rules[0].use[2]!../../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Ngon.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??clonedRuleSet-39[0].rules[0].use[0]!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/ts-loader/index.js??clonedRuleSet-39[0].rules[0].use[2]!../../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Ngon.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Ngon.vue?vue&type=template&id=30284d09&\"\nimport script from \"./Ngon.vue?vue&type=script&lang=ts&\"\nexport * from \"./Ngon.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","\n\n\n\nimport { Component, Prop, Vue } from \"vue-property-decorator\";\n\nimport Point from \"@/geometry/Point\";\nimport Ngon from \"./svg/Ngon.vue\";\n\n@Component({\n  components: { Ngon }\n})\nexport default class Face extends Vue {\n  @Prop({ required: true, type: Array }) vertices!: Point[];\n}\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??clonedRuleSet-39[0].rules[0].use[0]!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/ts-loader/index.js??clonedRuleSet-39[0].rules[0].use[2]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Face.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??clonedRuleSet-39[0].rules[0].use[0]!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/ts-loader/index.js??clonedRuleSet-39[0].rules[0].use[2]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Face.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Face.vue?vue&type=template&id=efce637c&scoped=true&\"\nimport script from \"./Face.vue?vue&type=script&lang=ts&\"\nexport * from \"./Face.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Face.vue?vue&type=style&index=0&id=efce637c&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"efce637c\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('g',{staticClass:\"HalfEdge\",class:{ inner: _vm.inner },on:{\"click\":_vm.onClick,\"mouseenter\":_vm.onMouseEnter,\"mouseleave\":_vm.onMouseLeave,\"mousemove\":_vm.onMouseMove}},[_c('extended-click-area',[(_vm.halfEdgeConfiguration(_vm.halfEdge).state.label)?_c('g',{staticClass:\"label\"},[_c('segment-label',{attrs:{\"at\":_vm.segment}},[_vm._v(_vm._s(_vm.halfEdgeConfiguration(_vm.halfEdge).state.label))])],1):_vm._e(),(_vm.indicator(_vm.halfEdge))?_c('arrow',{staticClass:\"indicator\",attrs:{\"segment\":_vm.indicator(_vm.halfEdge)}}):_vm._e(),(_vm.inner && _vm.indicator(-_vm.halfEdge))?_c('arrow',{staticClass:\"indicator\",attrs:{\"segment\":_vm.indicator(-_vm.halfEdge)}}):_vm._e(),(_vm.sourceIndicator)?_c('arrow',{staticClass:\"source\",attrs:{\"segment\":_vm.source}}):_vm._e(),_c('segment-component',{class:{ selected: _vm.selected, glued: _vm.glued },attrs:{\"segment\":_vm.segment}})],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('line',{attrs:{\"x1\":_vm.coords[0],\"y1\":_vm.coords[1],\"x2\":_vm.coords[2],\"y2\":_vm.coords[3]}})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\nimport { Component, Inject, Prop, Vue } from \"vue-property-decorator\";\n\nimport Segmnt from \"@/geometry/Segment\";\n\n@Component\nexport default class Segment extends Vue {\n  @Prop({ required: true, type: Object }) segment!: Segmnt;\n\n  // For performance reasons we compute all coordinates at once since this\n  // gets called a lot.\n  get coords() {\n    const embedded = this.svg(this.segment);\n    return [embedded.start.x, embedded.start.y, embedded.end.x, embedded.end.y];\n  }\n\n  @Inject()\n  svg!: (s: Segmnt) => Segmnt;\n}\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??clonedRuleSet-39[0].rules[0].use[0]!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/ts-loader/index.js??clonedRuleSet-39[0].rules[0].use[2]!../../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Segment.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??clonedRuleSet-39[0].rules[0].use[0]!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/ts-loader/index.js??clonedRuleSet-39[0].rules[0].use[2]!../../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Segment.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Segment.vue?vue&type=template&id=6290d963&\"\nimport script from \"./Segment.vue?vue&type=script&lang=ts&\"\nexport * from \"./Segment.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('g',{attrs:{\"transform\":_vm.transformation}},[_c('text',[_vm._t(\"default\")],2)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\nimport { Vue, Component, Inject, Prop } from \"vue-property-decorator\";\nimport Segment from \"@/geometry/Segment\";\nimport Vector from \"@/geometry/Vector\";\nimport Point from \"@/geometry/Point\";\n\n@Component\nexport default class HalfEdgeLabel extends Vue {\n\t@Prop({required: true, type: Object}) at!: Segment;\n\n\tget position() {\n\t\tconst midpoint = this.at.middle;\n\t\tlet normal = this.svg(this.at.tangentInStart.rotate90CCW()).normalize();\n\t\treturn this.svg(midpoint).translate(normal.multiply(12));\n\t}\n\n\tget transformation() {\n\t\treturn `translate(${this.position.x} ${this.position.y}) translate(6 4)`;\n\t}\n\n  @Inject()\n  svg!: ((xy: Point) => Point) & ((xy: Vector) => Vector);\n}\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??clonedRuleSet-39[0].rules[0].use[0]!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/ts-loader/index.js??clonedRuleSet-39[0].rules[0].use[2]!../../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./SegmentLabel.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??clonedRuleSet-39[0].rules[0].use[0]!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/ts-loader/index.js??clonedRuleSet-39[0].rules[0].use[2]!../../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./SegmentLabel.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./SegmentLabel.vue?vue&type=template&id=03911908&scoped=true&\"\nimport script from \"./SegmentLabel.vue?vue&type=script&lang=ts&\"\nexport * from \"./SegmentLabel.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./SegmentLabel.vue?vue&type=style&index=0&id=03911908&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"03911908\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('g',{staticClass:\"arrow\"},[_c('line',{attrs:{\"x1\":_vm.x1,\"y1\":_vm.y1,\"x2\":_vm.x2,\"y2\":_vm.y2}}),_c('path',{attrs:{\"d\":\"M 0 -3 L 12 0 L 0 3 z\",\"transform\":_vm.atEnd,\"stroke-width\":\"0\"}})])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\nimport { Prop, Vue, Component, Inject } from \"vue-property-decorator\";\nimport Segment from \"@/geometry/Segment\";\nimport Vector from \"@/geometry/Vector\";\nimport Point from \"@/geometry/Point\";\n\n@Component\nexport default class SVGArrow extends Vue {\n\t@Prop({required: true, type: Object}) segment!: Segment;\n\n  get x1() {\n    return this.svg(this.segment.start).x;\n  }\n\n  get y1() {\n    return this.svg(this.segment.start).y;\n  }\n\n  get endWithoutHead() {\n    return this.svg(this.segment.end).translate(this.svg(this.segment.tangentInEnd).normalize().multiply(12));\n  }\n\n  get x2() {\n    return this.svg(this.endWithoutHead).x;\n  }\n\n  get y2() {\n    return this.svg(this.endWithoutHead).y;\n  }\n\n\tget atEnd() {\n    return `translate(${this.x2} ${this.y2}) rotate(${-this.svg(this.segment).tangentInStart.angleTo(new Vector(this.svg(this.segment).parent, 1, 0))*360 / (2*Math.PI)} 0 0)`;\n\t}\n\n  @Inject()\n  svg!: ((xy: Point) => Point) & ((xy: Vector) => Vector) & ((xy: Segment) => Segment);\n}\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??clonedRuleSet-39[0].rules[0].use[0]!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/ts-loader/index.js??clonedRuleSet-39[0].rules[0].use[2]!../../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Arrow.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??clonedRuleSet-39[0].rules[0].use[0]!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/ts-loader/index.js??clonedRuleSet-39[0].rules[0].use[2]!../../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Arrow.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Arrow.vue?vue&type=template&id=184136dd&scoped=true&\"\nimport script from \"./Arrow.vue?vue&type=script&lang=ts&\"\nexport * from \"./Arrow.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Arrow.vue?vue&type=style&index=0&id=184136dd&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"184136dd\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('g',{staticClass:\"extended-click-area\",on:{\"mousedown\":function($event){$event.preventDefault();$event.stopPropagation();return (function (e) { return _vm.$emit('mousedown', e); }).apply(null, arguments)},\"click\":function (e) { return _vm.$emit('click', e); },\"mouseenter\":function (e) { return _vm.$emit('mouseenter', e); },\"mouseleave\":function (e) { return _vm.$emit('mouseleave', e); },\"mousemove\":function (e) { return _vm.$emit('mousemove', e); }}},[_vm._t(\"default\"),_c('g',{staticClass:\"extension\"},[_vm._t(\"default\")],2)],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import { render, staticRenderFns } from \"./ExtendedClickArea.vue?vue&type=template&id=27599fc9&scoped=true&\"\nvar script = {}\nimport style0 from \"./ExtendedClickArea.vue?vue&type=style&index=0&id=27599fc9&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"27599fc9\",\n  null\n  \n)\n\nexport default component.exports","import Segment from \"@/geometry/Segment\";\n\nexport interface IHalfEdgeConfiguration {\n  interactions: {\n    click: (ev: MouseEvent, segment: Segment) => void,\n    enter: (ev: MouseEvent, segment: Segment) => void,\n    leave: (ev: MouseEvent, segment: Segment) => void,\n    hover: (ev: MouseEvent, segment: Segment) => void,\n  },\n  state: {\n    selected: boolean,\n    glued: boolean,\n    label: string | null,\n    indicator: number | null,\n  },\n};\n\nexport const DefaultHalfEdgeConfiguration: IHalfEdgeConfiguration = {\n  interactions: {\n    click: () => {},\n    enter: () => {},\n    leave: () => {},\n    hover: () => {},\n  },\n  state: {\n    selected: false,\n    glued: false,\n    label: null,\n    indicator: null,\n  }\n};\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport { Component, Prop, Inject, Vue } from \"vue-property-decorator\";\n\nimport FlatTriangulationLayout from \"../geometry/layout/FlatTriangulationLayout\";\nimport Segment from \"@/geometry/Segment\";\nimport Vector from \"@/geometry/Vector\";\nimport SegmentComponent from \"./svg/Segment.vue\";\nimport HalfEdge from \"@/geometry/triangulation/HalfEdge\";\nimport SegmentLabel from \"./svg/SegmentLabel.vue\";\nimport Arrow from \"./svg/Arrow.vue\";\n\nimport ExtendedClickArea from \"./svg/ExtendedClickArea.vue\";\nimport { IHalfEdgeConfiguration, DefaultHalfEdgeConfiguration } from \"./HalfEdgeConfiguration\";\n\n@Component({\n  components: { Arrow, ExtendedClickArea, SegmentComponent, SegmentLabel },\n})\nexport default class HalfEdgeComponent extends Vue {\n  @Prop({required: true, type: Object}) surface!: FlatTriangulationLayout;\n  @Prop({required: true, type: Number}) halfEdge!: HalfEdge;\n  @Prop({required: true, type: Boolean}) inner!: boolean;\n  @Prop({required: false, type: Boolean, default: false}) sourceIndicator!: boolean;\n\n  onClick(ev: MouseEvent) {\n    this.halfEdgeConfiguration(this.halfEdge).interactions.click(ev, this.segment);\n  }\n\n  onMouseEnter(ev: MouseEvent) {\n    this.halfEdgeConfiguration(this.halfEdge).interactions.enter(ev, this.segment);\n  }\n\n  onMouseLeave(ev: MouseEvent) {\n    this.halfEdgeConfiguration(this.halfEdge).interactions.leave(ev, this.segment);\n  }\n\n  onMouseMove(ev: MouseEvent) {\n    this.halfEdgeConfiguration(this.halfEdge).interactions.hover(ev, this.segment);\n  }\n\n  get selected() {\n    return this.halfEdgeConfiguration(this.halfEdge).state.selected;\n  }\n\n  get glued() {\n    return this.halfEdgeConfiguration(this.halfEdge).state.glued;\n  }\n\n  get segment() {\n    return this.surface.layout(this.halfEdge).segment;\n  }\n\n  indicator(halfEdge: HalfEdge) {\n    const segment = this.surface.layout(halfEdge).segment;\n    let indicator = this.halfEdgeConfiguration(halfEdge).state.indicator;\n    if (indicator) {\n\t\t  const end = segment.at(indicator);\n\t\t  const start = end.translate(this.svg(segment.tangentInStart.rotate90CCW()).normalize().multiply(10));\n      return new Segment(start, end);\n    }\n\t}\n\n  get source() {\n    const segment = this.segment;\n\t\tconst end = segment.at(0);\n\t\tconst start = end.translate(this.svg(segment.tangentInStart.rotate90CCW()).normalize().multiply(10));\n    return new Segment(start, end);\n  }\n\n  @Inject({ default: () => DefaultHalfEdgeConfiguration })\n  halfEdgeConfiguration!: (halfEdge: HalfEdge) => IHalfEdgeConfiguration;\n\n  @Inject()\n  svg!: (xy: Vector) => Vector;\n}\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??clonedRuleSet-39[0].rules[0].use[0]!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/ts-loader/index.js??clonedRuleSet-39[0].rules[0].use[2]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./HalfEdge.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??clonedRuleSet-39[0].rules[0].use[0]!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/ts-loader/index.js??clonedRuleSet-39[0].rules[0].use[2]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./HalfEdge.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./HalfEdge.vue?vue&type=template&id=21a2eee6&\"\nimport script from \"./HalfEdge.vue?vue&type=script&lang=ts&\"\nexport * from \"./HalfEdge.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./HalfEdge.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","\n\n\n\n\n\n\n\n\n\n\n\nimport { Vue, Component, Prop } from \"vue-property-decorator\";\nimport Face from \"./Face.vue\";\nimport HalfEdgeComponent from \"./HalfEdge.vue\";\nimport FlatTriangulationLayout from \"../geometry/layout/FlatTriangulationLayout\";\n\n@Component({\n  components: {\n    Face,\n    HalfEdgeComponent,\n  }\n})\nexport default class FlatTriangulation extends Vue {\n  @Prop({required: true, type: Object}) surface!: FlatTriangulationLayout;\n\n  get faces() {\n    let faces = this.surface.surface.faces.cycles;\n    faces = faces.filter((face) => face.every((he) => this.surface.primary.includes(he)));\n    return faces.map((face) => face.map((he) => this.surface.layout(he).segment.end));\n  }\n\n  get halfEdges() {\n    return this.surface.surface.halfEdges.filter((halfEdge) => {\n      if (!this.surface.primary.includes(halfEdge))\n        return false;\n      if (!this.surface.layout(halfEdge).inner)\n        return true;\n      return halfEdge > 0;\n    });\n  }\n\n  // Return a list of vertex indicators where half edges meet that are almost collinear.\n  get sourceIndicators() {\n    return this.halfEdges.filter((a) => {\n      if (this.surface.layout(a).inner) return false;\n\n      const s = this.surface.layout(a).segment;\n      const v = s.tangentInStart;\n      return this.halfEdges.some((b) => {\n        if (b === a) return false;\n        if (this.surface.layout(b).inner) return false;\n\n        const t = this.surface.layout(b).segment;\n\n        if (!s.start.on(t)) return false;\n\n        const w = t.tangentInStart;\n        const angle = v.angleTo(w);\n        const degree = Math.PI / 180;\n        return angle < degree || angle > 359 * degree;\n      })\n    });\n  }\n}\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??clonedRuleSet-39[0].rules[0].use[0]!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/ts-loader/index.js??clonedRuleSet-39[0].rules[0].use[2]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./FlatTriangulation.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??clonedRuleSet-39[0].rules[0].use[0]!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/ts-loader/index.js??clonedRuleSet-39[0].rules[0].use[2]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./FlatTriangulation.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./FlatTriangulation.vue?vue&type=template&id=2d5dfdff&\"\nimport script from \"./FlatTriangulation.vue?vue&type=script&lang=ts&\"\nexport * from \"./FlatTriangulation.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./FlatTriangulation.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('g',{staticClass:\"FlowComponent\"},[_c('g',{style:({ '--color': _vm.color })},_vm._l((_vm.patches),function(vertices,i){return _c('ngon',{key:i,attrs:{\"vertices\":vertices}})}),1),_c('g',{staticClass:\"boundary\"},_vm._l((_vm.perimeter),function(connection,i){return _c('saddle-connection-component',{key:i,attrs:{\"connection\":connection,\"layout\":_vm.layout,\"color\":_vm.color}})}),1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('g',{staticClass:\"SaddleConnection\"},_vm._l((_vm.segments),function(segment,i){return _c('segment-component',{key:i,attrs:{\"segment\":segment}})}),1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\nimport FlatTriangulationLayout from '@/geometry/layout/FlatTriangulationLayout';\nimport  { Vue, Component, Prop } from \"vue-property-decorator\";\nimport SaddleConnectionData from \"../geometry/triangulation/SaddleConnection\";\nimport SegmentComponent from \"./svg/Segment.vue\";\nimport Segment from \"../geometry/Segment\";\nimport Point from \"../geometry/Point\";\nimport Line from \"../geometry/Line\";\nimport Vector from \"../geometry/Vector\";\n\n@Component({\n  components: {\n    SegmentComponent,\n  }\n})\nexport default class FlowComponent extends Vue {\n  @Prop({ required: true }) connection!: SaddleConnectionData;\n  @Prop({ required: true }) layout!: FlatTriangulationLayout;\n\n  get segments(): Segment[] {\n    const segments = [];\n\n    const vector = this.connection.vector;\n    const crossings = [...this.connection.crossings];\n\n    let start = this.layout.layout(this.connection.source).segment.start;\n    const end = crossings.length > 0 ? this.layout.layout(this.connection.target).segment.start : this.layout.layout(this.connection.source).segment.end;\n\n    // TODO: Use at() instead of halfEdge() to construct the point of intersection.\n    while(crossings.length) {\n\t\t  const crossing = crossings.shift()!;\n      if (this.layout.layout(crossing.halfEdge).inner)\n        continue;\n\n      // Since we are crossing an outer half edge, we compute the intersection\n      // of the saddle connection ray with it and add it to segments.\n      const line = new Line(start, start.translate(vector));\n      const crossingEdge = this.layout.layout(crossing.halfEdge).segment;\n      const crossingLine = new Line(crossingEdge.start, crossingEdge.end);\n      const intersection = line.intersect(crossingLine);\n      if (intersection === null) {\n        throw Error(\"saddle connection must intersect every crossing\");\n      }\n      segments.push(new Segment(start, intersection));\n\t\t  \n      // Now, we move the intersection point to the corresponding half-edge\n      // and repeat.\n      const alongHalfEdge = new Vector(intersection.parent, this.layout.layout(crossing.halfEdge).segment.start, intersection as Point);\n      start = this.layout.layout(-crossing.halfEdge).segment.end.translate(alongHalfEdge);\n    }\n\n    segments.push(new Segment(start, end));\n    \n    return segments;\n  }\n}\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??clonedRuleSet-39[0].rules[0].use[0]!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/ts-loader/index.js??clonedRuleSet-39[0].rules[0].use[2]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./SaddleConnection.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??clonedRuleSet-39[0].rules[0].use[0]!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/ts-loader/index.js??clonedRuleSet-39[0].rules[0].use[2]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./SaddleConnection.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./SaddleConnection.vue?vue&type=template&id=bddbc200&\"\nimport script from \"./SaddleConnection.vue?vue&type=script&lang=ts&\"\nexport * from \"./SaddleConnection.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","\n\n\n\n\n\n\n\n\n\n\nimport Flatten from \"@flatten-js/core\";\nimport  { Vue, Component, Prop, Watch } from \"vue-property-decorator\";\nimport FlowComponentData from \"../geometry/triangulation/FlowComponent\";\nimport { Touch } from \"../geometry/triangulation/FlowConnection\";\nimport SaddleConnectionComponent from \"./SaddleConnection.vue\";\nimport FlatTriangulationLayout from \"../geometry/layout/FlatTriangulationLayout\";\nimport Ngon from \"./svg/Ngon.vue\";\nimport HalfEdge from \"../geometry/triangulation/HalfEdge\";\nimport Point from \"../geometry/Point\";\nimport FlatTriangulation from \"../geometry/triangulation/FlatTriangulation\";\n\n@Component({\n  components: {\n    SaddleConnectionComponent,\n    Ngon,\n  },\n})\nexport default class FlowComponent extends Vue {\n  @Prop({ required: true }) component!: FlowComponentData;\n  @Prop({ required: true }) layout!: FlatTriangulationLayout;\n  @Prop({ required: true }) surface!: FlatTriangulation;\n  @Prop({ required: false, type: String, default:\"orange\" }) color!: string;\n\n  ats!: {[key: number]: number[]};\n  // Maps a half edge to the touches on that half edge in order.\n  touches!: {[key: number]: Touch[]};\n\n  get perimeter() {\n    let perimeter = this.component.perimeter;\n    if (this.component.cylinder)\n      // For cylinders do not show the connections at the top & bottom of the cylinder.\n      perimeter = perimeter.filter((connection) => connection.vertical);\n    else\n      // For minimal/undetermined components, do not show the inner structure of the component.\n      perimeter = perimeter.filter((connection) => connection.boundary);\n\n    return perimeter.map((connection) => connection.connection);\n  }\n\n  @Watch(\"layout\", { immediate: true })\n  resetCaches() {\n    this.ats = undefined as any;\n    this.touches = undefined as any;\n    this.ensureCaches();\n  }\n\n  ensureCaches() {\n    if (this.touches == null) {\n      this.touches = {};\n      for (const halfEdge of this.surface.halfEdges)\n        this.touches[halfEdge] = [];\n\n      for (const connection of this.component.perimeter) {\n        for (const touch of connection.touches) {\n          this.touches[touch.halfEdge][touch.index] = touch;\n        }\n      }\n    }\n    if (this.ats == null) {\n      this.ats = {};\n      for (const connection of this.component.perimeter) {\n        for (let i = 0; i < connection.touches.length; i++) {\n          const touch = connection.touches[i];\n          let at = 0;\n          if (i != 0 && i != connection.touches.length - 1) {\n            at = connection.connection.crossings[Math.floor((i - 1) / 2)].at;\n            if (i % 2 == 0)\n              at = 1 - at;\n          }\n          if (this.ats[touch.halfEdge] === undefined) this.ats[touch.halfEdge] = [];\n          this.ats[touch.halfEdge][touch.index] = at;\n        }\n      }\n    }\n  }\n\n  // Return the relative length in [0, 1] where `touch` intersects its half edge.\n  private at(touch: Touch): number {\n    console.assert(this.ats != null);\n    return this.ats[touch.halfEdge][touch.index];\n  }\n\n  // Return the triangle [A, B, C] completing the two touches `a`, `b`.\n  private patch(a: Touch, b: Touch): Point[] | null {\n    // Given `at` in [0, 1] returns the actual point on `halfEdge` that is that far on `halfEdge`.\n    const layout = (halfEdge: HalfEdge, at: number) => this.layout.layout(halfEdge).segment.at(at);\n\n    const isHalfEdge = a.halfEdge === -b.halfEdge;\n\n    const A = layout(a.halfEdge, this.at(a));\n    let B = isHalfEdge ? layout(a.halfEdge, 1) : layout(b.halfEdge, this.at(b));\n    let C = B;\n\n    let scenario = \"undefined\";\n\n    if (isHalfEdge) {\n      console.assert(this.at(a) === 0, \"Edge-parallel connection must start at vertex.\")\n      console.assert(this.at(b) === 0, \"Edge-parallel connection must end at vertex.\");\n    } else {\n      console.assert(a.halfEdge !== b.halfEdge, `Saddle Connection cannot cross the half edge ${a.halfEdge} twice in a row.`);\n    }\n\n    const atouches = this.touches[a.halfEdge];\n    const btouches = this.touches[b.halfEdge];\n\n    if (isHalfEdge) {\n      return null;\n    } else {\n      if (b.index === btouches.length - 1) {\n        if (this.at(b) === 1) {\n          // The vertex B of the patch is an actual vertex of the triangulation. We will search for C on A's half edge.\n\n          // Search for C on A's half edge.\n          console.assert(this.at(a) !== 0);\n          if (a.index === 0) {\n            // Everything next to A is part of this patch.\n            console.assert(this.at(a) !== 0);\n            C = layout(a.halfEdge, 0);\n          } else {\n            C = layout(a.halfEdge, this.at(atouches[a.index - 1]));\n          }\n        } else {\n          // Everything next to B is part of this patch.\n          scenario = \"remaining face\";\n          C = layout(b.halfEdge, 1);\n          if (this.at(b) === 0)\n            return null;\n        }\n      } else {\n        if (this.at(b) === this.at(btouches[b.index + 1])) {\n          // The vertex B of this patch is a vertex of the component.\n          console.assert(this.at(b) === 0 || this.at(b) === 1, \"Vertices of components must be aligned with the vertices of the triangulation.\");\n\n          // Search for C on A's half edge.\n          console.assert(this.at(a) !== 0);\n          if (a.index === 0) {\n            // Everything next to A is part of this patch.\n            console.assert(this.at(a) !== 0);\n            // TODO: Is this always taken care of by something else?\n            C = layout(a.halfEdge, 0);\n            return null;\n          } else {\n            // TODO: Is this always taken care of by something else?\n            C = layout(a.halfEdge, this.at(atouches[a.index - 1]));\n            return null;\n          }\n        } else {\n          console.assert(this.at(btouches[b.index + 1]) > this.at(b), `Touches are not ordered correctly on half edge ${b.halfEdge}. The ${btouches[b.index + 1].index}th touch at ${this.at(btouches[b.index + 1])} should not be after the ${b.index}th touch at ${this.at(b)}.`);\n          C = layout(b.halfEdge, this.at(btouches[b.index + 1]));\n        }\n      }\n    }\n\n    console.assert(!A.equalTo(B), `Patch of kind '${scenario}' coming from the touches (${a.halfEdge}, ${a.index}) at ${this.at(a)} and (${b.halfEdge}, ${b.index}) at ${this.at(b)} has the same point twice A == B, i.e., ${A.toString()} == ${B.toString()}.`);\n    console.assert(!A.equalTo(C), `Patch of kind '${scenario}' coming from the touches (${a.halfEdge}, ${a.index}) at ${this.at(a)} and (${b.halfEdge}, ${b.index}) at ${this.at(b)} has the same point twice A == C, i.e., ${A.toString()} == ${C.toString()}.`);\n    console.assert(!B.equalTo(C), `Patch of kind '${scenario}' coming from the touches (${a.halfEdge}, ${a.index}) at ${this.at(a)} and (${b.halfEdge}, ${b.index}) at ${this.at(b)} has the same point twice B == C, i.e., ${B.toString()} == ${C.toString()}.`);\n\n    return [A, B, C];\n  }\n\n  private patchHalfEdge(halfEdge: HalfEdge): Point[] | null {\n    // Given `at` in [0, 1] returns the actual point on `halfEdge` that is that far on `halfEdge`.\n    const layout = (halfEdge: HalfEdge, at: number) => this.layout.layout(halfEdge).segment.at(at);\n\n    const face = [halfEdge, this.surface.faces.image(halfEdge), this.surface.faces.preimage(halfEdge)];\n\n    const A = layout(halfEdge, 0);\n    const B = layout(halfEdge, 1);\n    let C = B;\n    let scenario = \"undefined\";\n\n    // Search for the third point of the patch on the following half edge in the face.\n    let touches = this.touches[face[1]]\n    if (touches.length === 0) {\n      // Since nothing intersects the following half edge in this face, this\n      // patch is the entire face.\n      scenario = \"entire face\";\n      C = layout(face[1], 1);\n      if (face[0] !== Math.min(...face))\n        return null;\n    } else if (this.at(touches[0]) === 0) {\n      // Something starts at the vertex joining this half edge with the\n      // following half edge...\n      touches = this.touches[-face[2]];\n      if (touches.every((touch) => this.at(touch) === 0 || this.at(touch) === 1)) {\n        // ...it is just the following half edge itself.\n        scenario = \"entire face 2\";\n        // TODO: Is this always taken care of by something else?\n        C = layout(face[1], 1);\n        if (face[0] !== Math.min(...face))\n          return null;\n      } else {\n        // It's another connection. So the patch ends at the beginning of the\n        // next half edge, none of that half edge is in the patch, i.e., the\n        // third point of the patch must be on the other half edge of this\n        // face.\n        scenario = \"on previous half edge\";\n        for (const touch of touches) {\n          if (this.at(touch) !== 0) {\n            // TODO: Is this always taken care of by something else?\n            C = layout(face[2], 1 - this.at(touch));\n            return null;\n            break;\n          }\n        }\n      }\n    } else {\n      scenario = \"on following half edge\";\n      C = layout(face[1], this.at(touches[0]));\n    }\n\n    console.assert(!A.equalTo(B), `Patch of kind '${scenario}' coming from the half edge ${halfEdge} has the same point twice A == B, i.e., ${A.toString()} == ${B.toString()}.`);\n    console.assert(!A.equalTo(C), `Patch of kind '${scenario}' coming from the half edge ${halfEdge} has the same point twice A == C, i.e., ${A.toString()} == ${C.toString()}.`);\n    console.assert(!B.equalTo(C), `Patch of kind '${scenario}' coming from the half edge ${halfEdge} has the same point twice B == C, i.e., ${B.toString()} == ${C.toString()}.`);\n\n    return [A, B, C];\n  }\n\n  get triangles(): Point[][] {\n    const triangles = [];\n\n    for (const connection of this.component.perimeter) {\n      for (let i = 0; i < connection.touches.length; i+=2) {\n        const patch = this.patch(connection.touches[i], connection.touches[i + 1])\n        if (patch !== null)\n          triangles.push(patch);\n      }\n    }\n\n    for (const inside of this.component.inside) {\n      const patch = this.patchHalfEdge(inside);\n      if (patch != null)\n        triangles.push(patch);\n    }\n\n    return triangles;\n  }\n\n  get patches(): Point[][] {\n    const patches = [];\n    const triangles = [...this.triangles];\n\n    const epsilon = (Flatten.Utils as any).getTolerance();\n\n    // Glue triangle to ngon if possible.\n    const glue = (ngon: Point[], triangle: Point[]) => {\n      console.assert(triangle.length === 3);\n      for (const step of [1, 2]) {\n        for (const t of [0, 1, 2]) {\n          for (let n = 0; n < ngon.length; n++) {\n            if (triangle[t].equalTo(ngon[n], epsilon) && triangle[(t + step) % 3].equalTo(ngon[(n + 1) % ngon.length], epsilon)) {\n              // Add the third point of the triangle that gets glued to the ngon.\n              ngon.splice(n + 1, 0, triangle[(t + 2*step) % 3]);\n\n              // Simplify the ngon if it contains the same point twice.\n              for (let nn = 0; nn < ngon.length; nn++) {\n                if (ngon[nn].equalTo(ngon[(nn + 2) % ngon.length], epsilon)) {\n                  if (nn + 1 == ngon.length) {\n                    ngon.splice(0, 2);\n                  } else if (nn + 2 == ngon.length) {\n                    ngon.splice(0, 1);\n                    ngon.pop();\n                  } else\n                    ngon.splice(nn, 2);\n                  break;\n                }\n              }\n\n              return true;\n            }\n          }\n        }\n      }\n\n      return false;\n    };\n\n    while(triangles.length) {\n      // Create an ngon by gluing triangles that share two points.\n      let patch = triangles.pop()!;\n      for (let t = triangles.length; t--;) {\n        if (glue(patch, triangles[t])) {\n          triangles[t] = triangles[triangles.length - 1];\n          triangles.pop();\n          t = triangles.length;\n        }\n      }\n\n      patches.push(patch);\n    }\n\n    return patches;\n  }\n}\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??clonedRuleSet-39[0].rules[0].use[0]!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/ts-loader/index.js??clonedRuleSet-39[0].rules[0].use[2]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./FlowComponent.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??clonedRuleSet-39[0].rules[0].use[0]!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/ts-loader/index.js??clonedRuleSet-39[0].rules[0].use[2]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./FlowComponent.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./FlowComponent.vue?vue&type=template&id=14584562&scoped=true&\"\nimport script from \"./FlowComponent.vue?vue&type=script&lang=ts&\"\nexport * from \"./FlowComponent.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./FlowComponent.vue?vue&type=style&index=0&id=14584562&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"14584562\",\n  null\n  \n)\n\nexport default component.exports","/* ******************************************************************************\n * Copyright (c) 2021 Julian Rüth <julian.rueth@fsfe.org>\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n * *****************************************************************************/\n\nimport iwanthue, { ColorSpacePreset } from \"iwanthue\";\n\nexport default class Palette {\n  constructor(colors: number = 2, space: ColorSpacePreset = \"fancy-light\") {\n    // TODO: Typings in iwanthue are wrong.\n    this.palette = iwanthue(colors >= 2 ? colors : 2, { seed: 1337 as any, colorSpace: space });\n  }\n\n  color(i: number) {\n    if (i >= this.palette.length)\n      console.warn(\"Color outside of palette bounds requested.\");\n    return this.palette[i % this.palette.length];\n  }\n\n  private readonly palette;\n}\n","/* ******************************************************************************\n * Copyright (c) 2021 Julian Rüth <julian.rueth@fsfe.org>\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n * *****************************************************************************/\n\nexport default class Progress {\n  constructor(name: string = \"\", steps: number = 0) {\n    this.name = name;\n    this.steps = steps;\n  }\n\n  public task(name: string, steps: number) {\n    this.steps += steps;\n    this.name = name;\n  }\n\n  public progress() {\n    this.step++;\n  }\n\n  public get stats(): { name: string, step?: number, steps?: number } {\n    return {\n      name: this.name,\n      step: (this.steps != null && this.step < this.steps) ? this.step : undefined,\n      steps: this.steps,\n    }\n  }\n\n  private step = 0;\n  private steps = 0;\n  private name: string;\n}\n","/* ******************************************************************************\n * Copyright (c) 2021 Julian Rüth <julian.rueth@fsfe.org>\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n * *****************************************************************************/\n\nexport class OperationAborted extends Error {}\n\nexport default class CancellationToken {\n  public cancellationRequested() {\n    return new Promise<boolean>((resolve, reject) => {\n      if (this.aborted) reject(new OperationAborted());\n      setTimeout(() => resolve(this.cancelled), 0);\n    });\n  }\n\n  public cancel() {\n    this.cancelled = true;\n  }\n\n  public abort() {\n    this.aborted = true;\n  }\n\n  private cancelled = false;\n  private aborted = false;\n}\n","/* ******************************************************************************\n * Copyright (c) 2020-2021 Julian Rüth <julian.rueth@fsfe.org>\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n * *****************************************************************************/\n\nimport minBy from \"lodash-es/minBy\";\nimport Flatten from \"@flatten-js/core\";\n\nimport Vector from \"../Vector\";\nimport HalfEdge from \"../triangulation/HalfEdge\";\nimport Automorphism from \"../triangulation/Automorphism\";\nimport HalfEdgeLayout from './HalfEdgeLayout';\nimport Point from '../Point';\nimport Segment from '../Segment';\nimport Polygon from '../Polygon';\nimport FlatTriangulation from '../triangulation/FlatTriangulation';\nimport Progress from \"@/Progress\";\nimport CancellationToken from \"@/CancellationToken\";\n\nexport default class CellLayout {\n  // Create a layout by walking the boundary of the cell in counter-clockwise\n  // order on the inside and summing up the associated vectors to determine the\n  // segment corresponding to each half edge.\n  public constructor(surface: FlatTriangulation, cell: HalfEdge[], origin: Point);\n  public constructor(surface: FlatTriangulation, layout: Record<HalfEdge, HalfEdgeLayout>);\n  public constructor(surface: FlatTriangulation, cell: HalfEdge[] | Record<HalfEdge, HalfEdgeLayout>, origin?: Point) {\n    this.surface = surface;\n\n    if (cell instanceof Array) {\n      console.assert(origin);\n      let end = origin!;\n      this.layout = Object.fromEntries(cell.map((he: HalfEdge) => {\n        const start = end;\n        end = end.translate(surface.vector(he));\n        return [he, {\n          segment: new Segment(origin!.parent, start.value, end.value),\n          inner: false,\n        }];\n      }));\n    } else {\n      this.layout = cell;\n    }\n\n    this.boundingRectArea = this.polygon.boundingRect.area();\n  }\n\n  // Translate this cell so that half edge coincides with segment.\n  translate(delta: Vector): void;\n  translate(halfEdge: HalfEdge, segment: Segment): void;\n  translate(halfEdge: HalfEdge | Vector, segment?: Segment) {\n    if (halfEdge instanceof Vector) {\n      const delta = halfEdge as Vector;\n      this.halfEdges.map((halfEdge) => {\n        this.layout[halfEdge].segment = this.layout[halfEdge].segment.translate(delta);\n      });\n    } else {\n      const before = this.layout[halfEdge].segment;\n      const delta = new Vector(before.parent, before.start, segment!.start);\n      \n      // https://github.com/alexbol99/flatten-js/pull/75\n      console.assert(before.translate(delta).equalTo(segment!, (Flatten.Utils as any).getTolerance()));\n\n      this.translate(delta);\n    }\n  }\n\n  // Return the HalfEdges that glue correctly between this layout and `other`\n  // currently or return an empty array if something overlaps or touches\n  // incorrectly.\n  glues(other: CellLayout): HalfEdge[] {\n    const otherPolygon = other.polygon;\n\n    const glued = [];\n\n    for (const halfEdge of this.halfEdges) {\n      if (this.layout[halfEdge].segment.intersects(otherPolygon)) {\n        // This half edge and the other cell have at least a point in common.\n\n        if (this.layout[halfEdge].segment.middle.on(otherPolygon)) {\n          if (other.halfEdges.includes(-halfEdge)) {\n            // If this half edge has its counterpart in the other cell, then we\n            // want them to be glued correctly.\n            if (this.layout[halfEdge].segment.equalTo(other.layout[-halfEdge].segment.reverse(), Flatten.Utils.getTolerance())) {\n              glued.push(halfEdge);\n              continue;\n            } else {\n              return [];\n            }\n          } else {\n            return [];\n          }\n        }\n\n        const intersections = this.layout[halfEdge].segment.intersect(otherPolygon);\n        if (intersections.length === 0) {\n          // This half edge is completely inside the other cell.\n          return [];\n        }\n\n        // Check whether the intersection points are consistently glued.\n        for (const intersection of intersections) {\n          const touchConsistent = (source: HalfEdge) => {\n              for (const vertex of this.surface.vertices.cycles) {\n                if (!vertex.includes(source)) continue;\n\n                for (const touch of vertex) {\n                  if (!other.halfEdges.includes(touch)) continue;\n\n                  if (intersection.equalTo(other.layout[touch].segment.start, Flatten.Utils.getTolerance()))\n                    return true;\n              }\n            };\n            // Not touching at a vertex or not touching at this vertex.\n            return false;\n          }\n\n          if (intersection.equalTo(this.layout[halfEdge].segment.start, Flatten.Utils.getTolerance())) {\n            // The cells touch at the starting point of this half edge. We\n            // check whether what it touches is the same vertex in the other\n            // cell.\n            if (!touchConsistent(halfEdge)) {\n              return [];\n            }\n          }\n          else if (intersection.equalTo(this.layout[halfEdge].segment.end, Flatten.Utils.getTolerance())) {\n            // The cells touch at the end point of this half edge. We\n            // check whether what it touches is the same vertex in the other\n            // cell.\n            if (!touchConsistent(-halfEdge)) {\n              return [];\n            }\n          } else {\n            // The cells touch not at the end point of a half edge.\n            return [];\n          }\n        }\n      }\n    }\n\n    console.assert(glued.length !== 0);\n    return glued;\n  }\n\n  touches(other: CellLayout): HalfEdge[] {\n    const otherPolygon = other.polygon;\n    return this.halfEdges.filter((halfEdge) => {\n      return !this.layout[halfEdge].inner && this.layout[halfEdge].segment.intersects(otherPolygon) || this.layout[halfEdge].segment.touch(otherPolygon);\n    });\n  }\n\n  // Return the boundary polygon of this cell (might not be connected.)\n  get polygon(): Polygon {\n    const polygon = new Flatten.Polygon();\n    this.boundaries.map((boundary) => {\n      polygon.addFace(boundary.map((side) => this.parent.embed(this.layout[side].segment).value));\n    });\n    return new Polygon(this.parent, polygon);\n  }\n\n  // Return the boundary polygons of this cell.\n  get boundaries() : HalfEdge[][] {\n    let pending = new Set(this.halfEdges.filter((he) => !this.layout[he].inner));\n    const boundaries = [] as HalfEdge[][];\n\n    while(pending.size) {\n      let start!: number;\n      for (start of pending) break;\n\n      const boundary = [] as HalfEdge[];\n      let next = start;\n      do {\n        next = -next;\n\n        do {\n          next = this.surface.vertices.preimage(next);\n        } while(this.layout[next].inner);\n\n        boundary.push(next);\n        pending.delete(next);\n      } while (next !== start);\n\n      boundaries.push(boundary);\n    }\n\n    return boundaries;\n  }\n\n  private get parent() {\n    return this.layout[this.halfEdges[0]].segment.parent;\n  }\n\n  public toString(): string {\n    return \"{\" + this.halfEdges.map((he) => `${he}: ${this.layout[he].segment}`).join(\", \") + \"}\";\n  }\n\n  get halfEdges(): HalfEdge[] {\n    return Object.keys(this.layout).map((halfEdge) => Number(halfEdge));\n  }\n\n  // Merge two of the cells by identifying two opposite half edges.\n  static async merge(cells: CellLayout[], force: (he: HalfEdge) => boolean | null, automorphisms: Automorphism[], cache: Record<HalfEdge, number | null> = {}, cancellation = new CancellationToken(), _progress = new Progress()): Promise<CellLayout[]> {\n    if (cells.length === 1)\n      return cells;\n\n    let scores = [] as {\n      glue: HalfEdge;\n      cell: CellLayout;\n      other: CellLayout;\n      score: number;\n    }[];\n\n    for (const cell of cells) {\n      if (await cancellation.cancellationRequested())\n        break;\n\n      for (const glue of cell.halfEdges) {\n        if (glue < 0) continue;\n        const other = cells.find((other) => other.halfEdges.includes(-glue))!;\n        if (cell === other) continue;\n\n        if (cache[glue] === undefined) {\n          cache[glue] = CellLayout.score(glue, cell, other, cells, force, automorphisms);\n        }\n\n        const score = cache[glue];\n\n        if (score === null)\n          continue;\n\n        scores.push({ glue, cell, other, score });\n      }\n    }\n\n    if (scores.length === 0)\n      return cells;\n\n    const best = minBy(scores, 'score')!;\n\n    for (const glue of Automorphism.orbit(best.glue, automorphisms)) {\n      const cell = cells.find((cell) => cell.halfEdges.includes(glue))!;\n      const other = cells.find((other) => other.halfEdges.includes(-glue))!;\n\n      console.assert(cell !== other);\n\n      const glued = CellLayout.glue(glue, cell, other);\n      glued.primary = best.glue === glue;\n\n      for (let halfEdge of glued.halfEdges) {\n        delete cache[halfEdge];\n        delete cache[-halfEdge];\n      }\n\n      cells = [glued, ...cells.filter((c) => c !== cell && c !== other)];\n    }\n\n    return cells;\n  }\n\n  // Return the score (lower is better) to the visual glueing of glue of\n  // parent and -glue of other; or return null if the two cannot be glued\n  // without overlaps in the resulting picture.\n  private static score(glue: HalfEdge, parent: CellLayout, other: CellLayout, cells: CellLayout[], force?: (he: HalfEdge) => boolean | null, automorphisms: Automorphism[] = []): number | null {\n    console.assert(parent.halfEdges.includes(glue) && other.halfEdges.includes(-glue));\n    console.assert(!parent.layout[glue].inner)\n    console.assert(!other.layout[-glue].inner);\n\n    if (!parent.primary)\n      return null;\n\n    other.translate(-glue, parent.layout[glue].segment.reverse());\n    const glues = parent.glues(other);\n    if (glues.length === 0) {\n      return null;\n    }\n\n    // Forbid gluing cells that contain identified edges.\n    for (const preimage of parent.halfEdges)\n      for (const image of Automorphism.orbit(preimage, automorphisms))\n        if (other.halfEdges.includes(image))\n          return null;\n\n    // Prefer edges that have been explicitly selected.\n    if (force) {\n      if (force(glue) === true)\n        return -force.length;\n      if (force(glue) === false)\n        return null;\n    }\n\n    // Prefer edges that keep Delaunay cells intact.\n    {\n      const ca = parent.surface.vector(glue);\n      const cb = parent.surface.vector(parent.surface.vertices.image(glue));\n      const dc = parent.surface.vector(-parent.surface.faces.image(-glue));\n\n      const a = dc.add(ca);\n      const b = dc.add(cb);\n      const c = dc;\n\n      const det = (x00: number, x01: number, x02: number, x10: number, x11: number, x12: number, x20: number, x21: number, x22: number) => x00 * (x11 * x22 - x12 * x21) - x10 * (x01 * x22 - x21 * x02) + x20 * (x01 * x12 - x11 * x02);\n\n      const delaunay = det(a.x, a.y, a.x * a.x + a.y * a.y, b.x, b.y, b.x * b.x + b.y * b.y, c.x, c.y, c.x * c.x + c.y * c.y);\n\n      if (Math.abs(delaunay) < (Flatten.Utils as any).getTolerance())\n        return 0;\n    }\n\n    // Prefer edges that minimize the area of a bounding rectangle of the glued area.\n    {\n      const ungluedArea = cells.map((cell) => cell.boundingRectArea).reduce((a, b) => a+b);\n\n      const gluedArea = cells.filter((cell) => cell !== parent && cell !== other).map((cell) => cell.boundingRectArea).reduce((a, b) => a + b, 0)\n        + CellLayout.glue(glues, parent, other).boundingRectArea;\n\n      return gluedArea / ungluedArea;\n    }\n  }\n\n  // Glue parent and other along glue and return the resulting cell.\n  private static glue(glues: HalfEdge[], parent: CellLayout, other: CellLayout): CellLayout;\n  private static glue(glue: HalfEdge, parent: CellLayout, other: CellLayout): CellLayout;\n  private static glue(glues: HalfEdge | HalfEdge[], parent: CellLayout, other: CellLayout): CellLayout {\n    if (!Array.isArray(glues)) {\n      other.translate(-glues, parent.layout[glues].segment.reverse());\n      return CellLayout.glue(parent.glues(other), parent, other);\n    } else {\n      console.assert(glues.length !== 0)\n      other.translate(-glues[0], parent.layout[glues[0]].segment.reverse());\n\n      // https://github.com/alexbol99/flatten-js/pull/75\n      for (const glue of glues)\n        console.assert(parent.layout[glue].segment.equalTo(other.layout[-glue].segment.reverse(), (Flatten.Utils as any).getTolerance()));\n\n      console.assert(Object.keys(parent.layout).every((he) => !other.layout.hasOwnProperty(he)));\n      console.assert(Object.keys(other.layout).every((he) => !parent.layout.hasOwnProperty(he)));\n\n      const glued = {...parent.layout, ...other.layout};\n      for (const glue of glues) {\n        glued[glue] = { segment: parent.layout[glue].segment, inner: true }\n        glued[-glue] = { segment: other.layout[-glue].segment, inner: true }\n      }\n\n      return new CellLayout(parent.surface, glued);\n    }\n  }\n\n  private static packable(cells: CellLayout[], packed: CellLayout[]) {\n    for (let i = 0; i < cells.length; i++) {\n      const cell = cells[i];\n\n      // Find a half edge that connects to something that has already been packed\n      for (let halfEdge of cell.halfEdges) {\n        for (let cell_ of packed) {\n          for (let halfEdge_ of cell_.halfEdges) {\n            if (halfEdge === -halfEdge_) {\n              cells.splice(i, 1);\n              return {\n                cell,\n                cell_,\n                halfEdge,\n                halfEdge_,\n              };\n            }\n          }\n        }\n      }\n    }\n\n    throw Error(`Could not find any cells packable with ${packed} among ${cells}`);\n  }\n\n  static pack(cells: CellLayout[], progress: Progress): CellLayout[] {\n    if (cells.length <= 1) return cells;\n\n    const packed = [cells.pop()] as CellLayout[];\n\n    progress.task(\"Packing Cells\", cells.length);\n\n    while (cells.length) {\n      progress.progress();\n\n      const {cell, cell_, halfEdge, halfEdge_} = CellLayout.packable(cells, packed)!;\n\n      const segment = cell.layout[halfEdge].segment;\n      const segment_ = cell_.layout[halfEdge_].segment.reverse();\n\n      cell.translate(halfEdge, segment_);\n\n      // We determine a distance that two edges have to be separated from each\n      // other to make it clear that they are not glued.\n      // The idea is that the entire `packed` presumably fills a notebook cell,\n      // probably 800 x 600 pixels. A gap of 10 pixels (minus SVG borders) can\n      // easily be recognized as a gap.\n      const screen = packed.map((cell) => cell.polygon.value.box).reduce((box, cell) => box.merge(cell), new Flatten.Box());\n      const step = Math.max((screen.xmax - screen.xmin) / 800, (screen.ymax - screen.ymin) / 600) * 10;\n      const delta = segment.tangentInStart.rotate90CCW().multiply(step);\n      \n      do {\n        cell.translate(delta);\n      } while(packed.some((other) => cell.touches(other).length))\n\n      packed.push(cell);\n    }\n\n    return packed;\n  }\n\n  protected readonly surface: FlatTriangulation;\n  protected readonly boundingRectArea: number;\n  public readonly layout: Record<HalfEdge, HalfEdgeLayout>;\n  // Whether this cell should be consider the primary copy of cells that are\n  // isomorphic under the automorphisms.\n  public primary: boolean = true;\n}\n","/* ******************************************************************************\n * Copyright (c) 2020 Julian Rüth <julian.rueth@fsfe.org>\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n * *****************************************************************************/\n\nimport Point from '../Point';\nimport FlatTriangulation from \"../triangulation/FlatTriangulation\";\nimport Automorphism from \"../triangulation/Automorphism\";\nimport HalfEdge from '../triangulation/HalfEdge';\nimport CellLayout from './CellLayout';\nimport HalfEdgeLayout from './HalfEdgeLayout';\nimport Box from '../Box';\nimport Polygon from \"../Polygon\";\nimport CancellationToken from \"@/CancellationToken\";\nimport Progress from \"@/Progress\";\n\nexport default class FlatTriangulationLayout {\n  private constructor(surface: FlatTriangulation, force?: (he: HalfEdge) => boolean | null, automorphisms?: Automorphism[]) {\n    this.surface = surface;\n    this.force = force || (() => null);\n    this.automorphisms = automorphisms || [];\n    this.primary = [];\n  }\n\n  public static async layout(surface: FlatTriangulation, force?: (he: HalfEdge) => boolean | null, automorphisms: Automorphism[] = [], cancellation = new CancellationToken(), progress = new Progress()) {\n    const layout = new FlatTriangulationLayout(surface, force, automorphisms);\n    await layout.recompute(cancellation, progress);\n    return layout;\n  }\n\n  private async recompute(cancellation: CancellationToken, progress: Progress) {\n    // Layout Algorithm:\n    // (1) Start from elementary cells, i.e., triangular faces.\n    // (2) Greedily glue any two cells as long as no overlap is produced,\n    //     prefering metrics such as the gluing that minimizes the area of a\n    //     bounding rectangle.\n    // (3) Pack the resulting cells into a box by randomly aligning\n    //     corresponding half edges to create a single polygon (with self intersections)\n    //     and move the pieces away from each other orthogonally until no overlaps\n    //     happen anymore.\n\n    // (1) Elementary Cells\n    if (this.surface.halfEdges.length === 0) {\n      this.halfEdges = {};\n      return;\n    }\n\n    const origin = new Point(this.surface.vector(this.surface.halfEdges[0]).parent, 0, 0);\n    let cells = this.surface.faces.cycles.map((face) => new CellLayout(this.surface, face, origin));\n\n    // (2) Glue Cells\n    progress.task(\"Gluing Cells\", cells.length - 1);\n    const cache = {};\n    for (const _ of Array(cells.length - 1)) {\n      progress.progress();\n      cells = await CellLayout.merge(cells, this.force, this.automorphisms, cache, cancellation, progress);\n    }\n\n    // (3) Pack Cells\n    cells = CellLayout.pack(cells.filter((cell) => cell.primary), progress);\n\n    this.halfEdges = Object.assign({}, ...cells.map((cell) => cell.layout));\n    this.primary = cells.filter((cell) => cell.primary).map((cell) => cell.halfEdges).flat();\n\n    for (const he of this.surface.halfEdges) {\n      if (this.force(he) === true && !this.layout(he).inner)\n        console.log(`Half edge ${he} should be visually glued in the layout but this was not possible.`);\n      if (this.force(he) === false && this.layout(he).inner)\n        console.error(`Half edge ${he} should not be visually glued in the layout but it is.`);\n    }\n  }\n\n  public layout(halfEdge: HalfEdge): HalfEdgeLayout & { primary: boolean } {\n    return {\n      ...this.halfEdges[halfEdge],\n      primary: this.primary.includes(halfEdge),\n    };\n  }\n\n  public get hull(): Polygon {\n    return Polygon.convexHull(this.primary.map((halfEdge) => [this.halfEdges[halfEdge].segment.start, this.halfEdges[halfEdge].segment.end]).flat());\n  }\n\n  public get bbox(): Box {\n    return Box.bbox(this.primary.map((halfEdge) => this.halfEdges[halfEdge].segment));\n  }\n\n  public readonly surface: FlatTriangulation;\n  private force: (he: HalfEdge) => boolean | null;\n  private automorphisms: Automorphism[];\n  private halfEdges!: Record<HalfEdge, HalfEdgeLayout>;\n  public primary!: HalfEdge[];\n}\n","/* ******************************************************************************\n * Copyright (c) 2021 Julian Rüth <julian.rueth@fsfe.org>\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n * *****************************************************************************/\n\nimport { optimize } from \"svgo/dist/svgo.browser.js\";\nimport rgba from \"color-normalize\";\n\n/*\n * Turns an <svg> in an HTML document into a standalone svg.\n */\nexport default class SVGExporter {\n  constructor(svg: Element) {\n    this.svg = svg.cloneNode(true) as Element;\n    this.styles = [svg, ...svg.getElementsByTagName(\"*\")].map(this.computedStyle);\n\n    if (this.svg.tagName !== 'svg') {\n      svg = document.createElement('svg');\n      svg.appendChild(this.svg);\n      this.svg = svg;\n\n      this.styles.unshift({});\n    }\n\n    this.svg.setAttribute(\"xmlns\", \"http://www.w3.org/2000/svg\");\n    this.svg.setAttribute(\"xmlns:xlink\", \"http://www.w3.org/1999/xlink\");\n  }\n\n  private get children() {\n    return [this.svg, ...this.svg.getElementsByTagName(\"*\")];\n  }\n\n  private computedStyle(element: Element) {\n    const style = window.getComputedStyle(element);\n    const computed = {} as { [key: string]: string };\n    for (let i = 0; i < style.length; i++)\n      computed[style[i]] = style.getPropertyValue(style[i]);\n    return computed;\n  }\n\n  /*\n   * Return the index of `e` in `styles`.\n   */\n  private index(e: Element) {\n    const children = this.children;\n    console.assert(children.length == this.styles.length);\n\n    for (let index = 0; index < children.length; index++) {\n      if (children[index] === e)\n        return index;\n    }\n\n    throw Error(\"Element not found in DOM tree.\")\n  }\n\n  /*\n   * Drop all class=\"\" attributes from all elements.\n   */\n  public dropClasses() {\n    for (const child of this.children) {\n      child.removeAttribute('class');\n    }\n  }\n\n  /*\n   * Drop all prefixed styles from all elements, i.e., things such as\n   * `-webkit-...` and `--variable`.\n   */\n  public dropPrefixedStyles() {\n    this.styles = this.styles.map((styles) => {\n      return Object.fromEntries(\n        Object.entries(styles).filter(([key, _value]) => !key.startsWith('-'))\n      );\n    });\n  }\n\n  /*\n   * Drop all elements that are not visible from the element tree.\n   */\n  public dropInvisible() {\n    const children = this.children;\n    console.assert(children.length === this.styles.length);\n\n    const trash = {} as {[index: number]: Element};\n\n    const addToTrash = (element: Element) => {\n      const index = this.index(element);\n\n      if (index in trash)\n        return;\n      trash[index] = element;\n\n      [...element.children].forEach(addToTrash);\n    };\n\n    for (let index = 1; index < children.length; index++) {\n      const child = children[index];\n      const style = this.styles[index];\n      if (style[\"visibility\"] === \"hidden\" || style[\"display\"] === \"none\")\n        addToTrash(child);\n    }\n\n    this.styles = this.styles.filter((_style, i) => !(i in trash));\n\n    for (const element of Object.values(trash)) {\n      if (element.parentNode != null) {\n        element.parentNode.removeChild(element);\n      }\n    }\n\n    console.assert(this.children.length === this.styles.length);\n\n    // Now we can drop all \"visibility: visible\" and \"display: \" which has no\n    // effect in SVG anymore.\n    this.styles = this.styles.map((styles) => {\n      return Object.fromEntries(\n        Object.entries(styles).filter(([key, _value]) => key !== \"visibility\" && key !== \"display\")\n      );\n    });\n  }\n\n  /*\n   * Drop styling that is already equally set on the parent node.\n   */\n  public dropRedundantStyles() {\n    const children = this.children;\n    console.assert(children.length === this.styles.length);\n\n    for (let index = children.length; index--;) {\n      const child = children[index];\n      const parent = child.parentNode as Element;\n\n      if (parent == null) continue;\n\n      const style = this.styles[this.index(parent)];\n      this.styles[index] = Object.fromEntries(\n        Object.entries(this.styles[index]).filter(([key, value]) => style[key] != value)\n      );\n    }\n  }\n\n  /*\n   * Drop custom attributes such as `data-attribute=\"\"`.\n   */\n  public dropCustomAttributes() {\n    for (const child of this.children) {\n      [...child.attributes].forEach((attribute) => {\n        if (attribute.name.includes('-'))\n          child.removeAttribute(attribute.name);\n      });\n    }\n  }\n\n  private static readonly standard = [ \"cx\", \"cy\", \"height\", \"width\", \"x\", \"y\", \"r\", \"rx\", \"ry\", \"d\", \"fill\", \"transform\", \"alignment-baseline\", \"baseline-shift\", \"clip-path\", \"clip-rule\", \"color\", \"color-interpolation\", \"color-interpolation-filters\", \"color-rendering\", \"cursor\", \"direction\", \"display\", \"dominant-baseline\", \"fill-opacity\", \"fill-rule\", \"filter\", \"flood-color\", \"flood-opacity\", \"font-family\", \"font-size\", \"font-size-adjust\", \"font-stretch\", \"font-style\", \"font-variant\", \"font-weight\", \"glyph-orientation-horizontal\", \"glyph-orientation-vertical\", \"image-rendering\", \"letter-spacing\", \"lighting-color\", \"marker-end\", \"marker-mid\", \"marker-start\", \"mask\", \"opacity\", \"overflow\", \"paint-order\", \"pointer-events\", \"shape-rendering\", \"stop-color\", \"stop-opacity\", \"stroke\", \"stroke-dasharray\", \"stroke-dashoffset\", \"stroke-linecap\", \"stroke-linejoin\", \"stroke-miterlimit\", \"stroke-opacity\", \"stroke-width\", \"text-anchor\", \"text-decoration\", \"text-overflow\", \"text-rendering\", \"unicode-bidi\", \"vector-effect\", \"visibility\", \"white-space\", \"word-spacing\", \"writing-mode\", \"display\", \"overflow\", \"visibility\", \"text-overflow\", \"clip-path\", \"clip-rule\", \"mask\", \"color\", \"opacity\", \"color-interpolation-filters\", \"filter\", \"flood-color\", \"flood-opacity\", \"lighting-color\", \"isolation\", \"transform\", \"transform-box\", \"transform-origin\", \"letter-spacing\", \"text-align\", \"text-align-last\", \"text-indent\", \"word-spacing\", \"white-space\", \"vertical-align\", \"dominant-baseline\", \"alignment-baseline\", \"baseline-shift\", \"direction\", \"text-orientation\", \"writing-mode\", \"font\", \"text-decoration\", \"text-decoration-line\", \"text-decoration-style\", \"text-decoration-color\"];\n\n  /*\n   * Drop styles that are not explititly supported by SVG 2, see\n   * https://www.w3.org/TR/SVG/styling.html#RequiredProperties\n   */\n  public dropNonStandardStyles() {\n    this.styles = this.styles.map((styles) => {\n      return Object.fromEntries(\n        Object.entries(styles).filter(([key, _value]) => {\n          if (SVGExporter.standard.includes(key))\n            return true;\n          if (key.startsWith(\"font-\"))\n            return true;\n        })\n      )\n    });\n  }\n\n  /*\n   * Rewrite style as presentation attributes.\n   * Drop all styles that can be presentation attributes from elements where they are not allowed.\n   * This helps some SVG readers and also svgo to optimize the output.\n   */\n  public usePresentationAttributes() {\n    const children = this.children;\n    console.assert(children.length === this.styles.length);\n\n    for (let index = children.length; index--;) {\n      const child = children[index];\n\n      const makePresentation = (key: string, value: string) => {\n        if (!child.hasAttribute(key))\n          child.setAttribute(key, value);\n      };\n\n      this.styles[index] = Object.fromEntries(\n        Object.entries(this.styles[index]).filter(([key, value]) => {\n          if ([\"cx\", \"cy\"].includes(key)) {\n            if ([\"circle\", \"ellipse\"].includes(child.tagName))\n              return makePresentation(key, value);\n            return false;\n          } else if ([\"height\", \"width\", \"x\", \"y\"].includes(key)) {\n            if ([\"foreignObject\", \"image\", \"rect\", \"svg\", \"symbol\", \"use\"].includes(child.tagName))\n              return makePresentation(key, value);\n            return false;\n          } else if ([\"r\"].includes(key)) {\n            if ([\"circle\"].includes(child.tagName))\n              return makePresentation(key, value);\n            return false;\n          } else if ([\"rx\", \"ry\"].includes(key)) {\n            if ([\"ellipse\", \"rect\"].includes(child.tagName))\n              return makePresentation(key, value);\n            return false;\n          } else if ([\"d\"].includes(key)) {\n            if ([\"path\"].includes(child.tagName))\n              makePresentation(key, value);\n            return false;\n          } else if ([\"fill\"].includes(key)) {\n            if (![\"animate\", \"set\", \"animateMotion\"].includes(child.tagName))\n              makePresentation(key, value);\n            return false;\n          } else if ([\"transform\"].includes(key) && value != \"none\") {\n            if (![\"pattern\", \"linearGradien\", \"radialGradient\"].includes(child.tagName))\n              makePresentation(key, value);\n            else if ([\"pattern\"].includes(child.tagName))\n              makePresentation(\"patternTransform\", value);\n            else if ([\"linearGradient\", \"radialGradient\"].includes(child.tagName))\n              makePresentation(\"gradientTransform\", value);\n            return false;\n          } else if ([\"alignment-baseline\", \"baseline-shift\", \"clip-path\", \"clip-rule\", \"color\", \"color-interpolation\", \"color-interpolation-filters\", \"color-rendering\", \"cursor\", \"direction\", \"display\", \"dominant-baseline\", \"fill-opacity\", \"fill-rule\", \"filter\", \"flood-color\", \"flood-opacity\", \"font-family\", \"font-size\", \"font-size-adjust\", \"font-stretch\", \"font-style\", \"font-variant\", \"font-weight\", \"glyph-orientation-horizontal\", \"glyph-orientation-vertical\", \"image-rendering\", \"letter-spacing\", \"lighting-color\", \"marker-end\", \"marker-mid\", \"marker-start\", \"mask\", \"opacity\", \"overflow\", \"paint-order\", \"pointer-events\", \"shape-rendering\", \"stop-color\", \"stop-opacity\", \"stroke\", \"stroke-dasharray\", \"stroke-dashoffset\", \"stroke-linecap\", \"stroke-linejoin\", \"stroke-miterlimit\", \"stroke-opacity\", \"stroke-width\", \"text-anchor\", \"text-decoration\", \"text-overflow\", \"text-rendering\", \"unicode-bidi\", \"vector-effect\", \"visibility\", \"white-space\", \"word-spacing\", \"writing-mode\"].includes(key)) {\n            makePresentation(key, value);\n            return false;\n          }\n          return true;\n        })\n      );\n    }\n  }\n  public simplifyColors() {\n    const children = this.children;\n    console.assert(children.length === this.styles.length);\n\n    const simplify = (child: Element, style: {[key: string]: string}, key: string, okey: string | null = null) => {\n      if (child.getAttribute(key))\n        delete style[key];\n      if (okey != null && child.getAttribute(okey))\n        delete style[okey];\n\n      const value = style[key];\n      if (value == null || value == \"none\")\n        return;\n\n      const color = rgba(value);\n      const opacity = color[3];\n      if (okey != null) {\n        style[okey] = String(Number(child.getAttribute(okey) || style[okey] || 1) * opacity);\n        child.removeAttribute(okey);\n      }\n\n      style[key] = `rgb(${color[0]*255}, ${color[1]*255}, ${color[2]*255})`;\n    };\n\n    for (let index = children.length; index--;) {\n      const child = children[index];\n      const style = this.styles[index];\n\n      simplify(child, style, \"fill\", \"fill-opacity\");\n      simplify(child, style, \"stroke\", \"stroke-opacity\");\n      simplify(child, style, \"color\");\n      simplify(child, style, \"text-decoration\");\n      simplify(child, style, \"text-decoration-color\");\n\n      this.styles[index] = style;\n    }\n  }\n\n  /*\n   * Drop trivial styles.\n   */\n  public dropTrivialStyles() {\n    this.styles = this.styles.map((styles) => {\n      return Object.fromEntries(\n        Object.entries(styles).filter(([key, value]) => {\n          if (key == \"transform\" && value == \"none\")\n            return false;\n          if (key == \"filter\" && value == \"none\")\n            return false;\n\n          return true;\n        })\n      )\n    });\n  }\n\n  /*\n   * Drop styles that confuse inkscape (as of 1.1)\n   */\n  public dropNonInkscapeStyles() {\n    this.styles = this.styles.map((styles) => {\n      return Object.fromEntries(\n        Object.entries(styles).filter(([key, value]) => {\n          if (key == \"font-synthesis\")\n            return false;\n          if (key == \"vertical-align\")\n            return false;\n          if (key == \"transform-origin\")\n            return false;\n          if (key == \"transform-box\")\n            return false;\n          if (key == \"text-overflow\")\n            return false;\n          if (key == \"text-align-last\")\n            return false;\n          if (key == \"mask\")\n            return false;\n          if (key == \"font-optical-sizing\")\n            return false;\n          if (key == \"font-language-override\")\n            return false;\n          if (key == \"font-kerning\")\n            return false;\n          if (key == \"clip-path\")\n            return false;\n          if (key == \"transform\" && value == \"none\")\n            return false;\n\n          if (SVGExporter.standard.includes(key))\n            return true;\n          if (key.startsWith(\"font-\"))\n            return true;\n        })\n      )\n    });\n  }\n\n  public dropInteractiveStyles() {\n    this.styles = this.styles.map((styles) => {\n      return Object.fromEntries(\n        Object.entries(styles).filter(([key, _value]) => {\n          if (key == \"cursor\")\n            return false;\n          if (key == \"pointer-events\")\n            return false;\n\n          return true;\n        })\n      )\n    });\n  }\n\n  /*\n   * Inline all styling into the elements `style` attribute.\n   * This is usually the last method to call before `toString()`.\n   */\n  public inlineStyles() {\n    const children = this.children;\n    console.assert(children.length == this.styles.length);\n\n    for (let i = 0; i < children.length; i++) {\n      const child = children[i];\n      const style = Object.entries(this.styles[i]).map(([key, value]) => {\n        return `${key}: ${value};`\n      }).join(\" \");\n      if (style)\n        child.setAttribute('style', style);\n      else\n        child.removeAttribute('style');\n    }\n  }\n\n  /*\n   * Return the extracted SVG as a string.\n   */\n  public toString(svgo: boolean = true) {\n    let svg = this.svg.outerHTML;\n    if (svgo)\n      svg = optimize(svg).data;\n    return svg;\n  }\n\n  // A clone of the original SVG node from the DOM.\n  private svg: Element;\n\n  // The computed style of each node in the original SVG node in traversal order.\n  private styles: Array<{ [key: string]: string }> = [];\n}\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport { Component, Prop, Vue, Provide, Inject, Watch } from \"vue-property-decorator\";\n\nimport Viewport from \"../geometry/Viewport\";\nimport FlatTriangulation from \"../geometry/triangulation/FlatTriangulation\";\nimport FlatTriangulationComponent from \"./FlatTriangulation.vue\";\nimport HalfEdge from \"../geometry/triangulation/HalfEdge\";\nimport FlowComponent from \"../geometry/triangulation/FlowComponent\";\nimport Automorphism from \"../geometry/triangulation/Automorphism\";\nimport FlowComponentComponent from \"./FlowComponent.vue\";\nimport Palette from \"@/Palette\";\n\nimport Point from \"@/geometry/Point\";\nimport Vector from \"@/geometry/Vector\";\nimport Segment from \"@/geometry/Segment\";\nimport FlatTriangulationLayout from '@/geometry/layout/FlatTriangulationLayout';\nimport { IHalfEdgeConfiguration } from \"./HalfEdgeConfiguration\";\n\nimport CancellationToken, { OperationAborted } from \"@/CancellationToken\";\nimport Progress from \"@/Progress\";\n\nimport SVGExporter from \"@/export/SVGExporter\";\n\nimport clamp from \"lodash-es/clamp\";\n\n@Component({\n  components: {\n    FlatTriangulationComponent,\n    FlowComponentComponent,\n  }\n})\nexport default class Surface extends Vue {\n  @Prop({ required: true }) viewport!: Viewport;\n  @Prop({ required: true }) surface!: FlatTriangulation;\n  @Prop({ required: false, default: () => [], type: Array }) components!: FlowComponent[];\n  @Prop({ required: false, default: () => [], type: Array }) inner!: HalfEdge[];\n  @Prop({ required: false, default: () => [], type: Array }) automorphisms!: Automorphism[];\n  \n  private forced = [] as HalfEdge[];\n  private selected = [] as HalfEdge[];\n  private hovered = [] as HalfEdge[];\n  private visibleComponents = [] as FlowComponent[];\n  private indicator = {} as Record<HalfEdge, number | null>;\n  private defaultLabel = {} as Record<HalfEdge, string | null>;\n  private label = {} as Record<HalfEdge, string | null>;\n  private cancellation = new CancellationToken();\n  private layout = null as FlatTriangulationLayout | null;\n\n  static _run(callback: (cancellation: CancellationToken, progress: Progress) => Promise<void>): void {\n    callback(new CancellationToken(), new Progress());\n  }\n\n  @Inject({ from: 'run', default: () => Surface._run})\n  run!: (callback: (cancellation: CancellationToken, progress: Progress) => Promise<void>) => void;\n\n  created() {\n    this.relayout();\n  }\n\n  private nextLabel(label: string) {\n    let chars = label.split('').map((c) => c.charCodeAt(0) - 65);\n    chars[chars.length - 1]++;\n    for (let i = chars.length; i--;) {\n      if (chars[i] == 25) {\n        chars[i] = 0;\n        if (i == 0)\n          chars = [0, ...chars];\n        else\n          chars[i - 1]++;\n      }\n    }\n\n    return chars.map((code) => String.fromCharCode(65 + code)).join('');\n  }\n\n  async relayout() {\n    this.cancellation.abort();\n    this.run(async (cancellation, progress) => {\n      this.cancellation = cancellation;\n      try {\n        this.layout = await FlatTriangulationLayout.layout(this.surface, (he: HalfEdge) => (this.forced.includes(he) || this.forced.includes(-he)) ? true : null, this.automorphisms, this.cancellation, progress);\n      } catch (e) {\n        if (e instanceof OperationAborted) return;\n        throw e;\n      }\n      \n      // Only display components whose half edges and faces have been rendered.\n      this.visibleComponents = this.components.filter((component) =>\n        !component.perimeter.some((connection) =>\n          ! this.layout!.primary.includes(connection.connection.source) && !this.layout!.primary.includes(connection.connection.target)\n        )\n      );\n      \n      // Reset indicators\n      this.indicator = Object.fromEntries(this.surface.halfEdges.map((halfEdge) => [halfEdge, null]));\n\n      // Recompute labels\n      let nextLabel = \"A\";\n      const componentInnerHalfEdges = [...this.visibleComponents.filter((component) => component.cylinder).map((component) => component.inside)];\n      const cylinderInnerHalfEdges = componentInnerHalfEdges.map((halfEdges) => halfEdges.filter((halfEdge) => halfEdges.includes(-halfEdge))).flat();\n\n      this.defaultLabel = {};\n      for (const halfEdge of this.surface.halfEdges) {\n        if (this.defaultLabel[halfEdge] !== undefined)\n          continue;\n\n        if (!this.layout!.layout(halfEdge).primary)\n          continue\n\n        // Do not show labels for half edges in the interior of cylinders.\n        if (cylinderInnerHalfEdges.includes(halfEdge)) {\n          this.defaultLabel[halfEdge] = null;\n          continue;\n        }\n\n        if (this.layout!.layout(halfEdge).inner) {\n          this.defaultLabel[halfEdge] = null;\n          continue;\n        }\n        \n        for (const orbit of Automorphism.orbit(halfEdge, this.automorphisms)) {\n          this.defaultLabel[orbit] = nextLabel;\n          this.defaultLabel[-orbit] = nextLabel;\n        }\n\n        nextLabel = this.nextLabel(nextLabel);\n      }\n\n      // Reset labels\n      this.label = Object.fromEntries(this.surface.halfEdges.map((halfEdge) => [halfEdge, this.defaultLabel[halfEdge]]));\n\n      this.$emit('layout', this.layout);\n      this.$nextTick(() => {\n        // TODO: Maybe we should not always export the SVG but only do so on demand.\n        const exporter = new SVGExporter(this.$refs.svg as HTMLElement);\n        exporter.simplifyColors();\n        exporter.dropNonStandardStyles();\n        exporter.dropNonInkscapeStyles();\n        exporter.dropTrivialStyles();\n        exporter.dropRedundantStyles();\n        exporter.dropClasses();\n        exporter.dropPrefixedStyles();\n        exporter.dropInvisible();\n        exporter.dropInteractiveStyles();\n        exporter.dropCustomAttributes();\n        exporter.usePresentationAttributes();\n        exporter.inlineStyles();\n        this.$emit('svg', exporter.toString());\n      });\n    });\n  }\n\n  get palette() {\n    return new Palette(this.visibleComponents.length);\n  }\n\n  @Provide()\n  svg(xy: Vector | Point | Segment) : Vector | Point | Segment {\n    if (xy instanceof Vector)\n      return this.viewport.viewportCoordinateSystem.embed(xy);\n    if (xy instanceof Point)\n      return this.viewport.viewportCoordinateSystem.embed(xy);\n    if (xy instanceof Segment)\n      return this.viewport.viewportCoordinateSystem.embed(xy);\n    throw new Error(\"Cannot embed this type into the SVG coordinate system yet.\");\n  }\n\n  @Watch(\"forced\")\n  onForcedChanged() {\n    this.relayout();\n  }\n\n  @Watch(\"inner\", {immediate: true})\n  onInnerChanged() {\n    this.forced = this.inner;\n  }\n\n  forceHalfEdge(halfEdge: HalfEdge) {\n    this.forced.push(halfEdge);\n  }\n\n  async glue(halfEdge: HalfEdge) {\n    if (this.forced.includes(halfEdge) || this.forced.includes(-halfEdge))\n      this.forced = this.forced.filter((he) => he !== halfEdge && he !== -halfEdge);\n    else\n      this.forced.unshift(halfEdge);\n\n    this.selected.push(halfEdge); \n\n    await new Promise(resolve => this.$once(\"layout\", resolve));\n\n    await new Promise(resolve => setTimeout(resolve, 500));\n\n    this.selected = this.selected.filter((he) => he !== halfEdge && he !== -halfEdge);\n  }\n\n  hover(hover: HalfEdge, at: number) {\n    at = clamp(at, 0, 1);\n    for (const halfEdge of Automorphism.orbit(hover, this.automorphisms)) {\n      this.hovered.push(halfEdge);\n      this.indicator[halfEdge] = at;\n      this.indicator[-halfEdge] = 1 - at;\n      this.label[halfEdge] = String(halfEdge);\n      this.label[-halfEdge] = String(-halfEdge);\n    }\n  }\n\n  unhover(hover: HalfEdge) {\n    for (const halfEdge of Automorphism.orbit(hover, this.automorphisms)) {\n      this.hovered = this.hovered.filter((he) => he !== halfEdge && he !== -halfEdge);\n      this.indicator[halfEdge] = null;\n      this.indicator[-halfEdge] = null;\n      this.label[halfEdge] = this.defaultLabel[halfEdge];\n      this.label[-halfEdge] = this.defaultLabel[-halfEdge];\n    }\n  }\n\n  // TODO: This should live in a more generic place.\n  private relativizeOntoSegment(segment: Segment, point: Point): number {\n    const e = segment.value.tangentInStart();\n    const toPoint = new Vector(segment.parent, segment.start, point).value;\n    return e.dot(toPoint) / segment.value.length;\n  }\n\n  // TODO: This is a weird name.\n  @Provide()\n  halfEdgeConfiguration(halfEdge: HalfEdge): IHalfEdgeConfiguration {\n    return {\n      interactions: {\n        click: () => {\n          this.unhover(halfEdge)\n          this.glue(halfEdge)\n        },\n        // TODO: This assumes that this component fills the viewport coordinate system. That's probably always in practice true but maybe we should inject the offset.\n        enter: (ev: MouseEvent, segment: Segment) => this.hover(halfEdge, this.relativizeOntoSegment(segment, new Point(this.viewport.viewportCoordinateSystem, ev.clientX - this.$el.getBoundingClientRect().left, ev.clientY - this.$el.getBoundingClientRect().top))),\n        leave: () => this.unhover(halfEdge),\n        hover: (ev: MouseEvent, segment: Segment) => this.hover(halfEdge, this.relativizeOntoSegment(segment, new Point(this.viewport.viewportCoordinateSystem, ev.clientX - this.$el.getBoundingClientRect().left, ev.clientY - this.$el.getBoundingClientRect().top))),\n      },\n      state: {\n        selected: this.selected.includes(halfEdge) || this.selected.includes(-halfEdge),\n        glued: this.forced.includes(halfEdge) || this.forced.includes(-halfEdge),\n        label: this.label[halfEdge],\n        indicator: this.indicator[halfEdge],\n      },\n    };\n  }\n}\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??clonedRuleSet-39[0].rules[0].use[0]!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/ts-loader/index.js??clonedRuleSet-39[0].rules[0].use[2]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Surface.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??clonedRuleSet-39[0].rules[0].use[0]!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/ts-loader/index.js??clonedRuleSet-39[0].rules[0].use[2]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Surface.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Surface.vue?vue&type=template&id=4ba7b6be&\"\nimport script from \"./Surface.vue?vue&type=script&lang=ts&\"\nexport * from \"./Surface.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","\n\n\n\n\n\n\n\n\n\n\nimport { Component, Prop, Vue, Watch } from \"vue-property-decorator\";\nimport YAML from \"yaml\";\n\nimport Flatten from \"@flatten-js/core\";\n\nimport CoordinateSystem from \"@/geometry/CoordinateSystem\";\nimport FlatTriangulation from \"@/geometry/triangulation/FlatTriangulation\";\nimport Automorphism from \"@/geometry/triangulation/Automorphism\";\nimport FlowComponent from \"@/geometry/triangulation/FlowComponent\";\nimport FlatTriangulationLayout from \"@/geometry/layout/FlatTriangulationLayout\";\nimport HalfEdge from \"../geometry/triangulation/HalfEdge\";\nimport Vector from \"../geometry/Vector\";\n\nimport PanZoom from \"./PanZoom.vue\";\nimport Surface from \"./Surface.vue\";\n\n@Component({\n  components: {\n    Surface,\n    PanZoom,\n  }\n})\nexport default class SurfaceViewer extends Vue {\n  @Prop({ required: true }) raw!: string;\n  @Prop({ required: false, default: () => [], type: Array }) inner!: HalfEdge[];\n\n  private readonly idealCoordinateSystem = new CoordinateSystem(true);\n  protected surface: FlatTriangulation | null = null;\n  protected components: FlowComponent[] = [];\n  protected automorphisms: Automorphism[] = [];\n\n  focus = this.idealCoordinateSystem.embed(this.idealCoordinateSystem.box([-1, -1], [1, 1]));\n\n  protected onLayoutChanged(layout: FlatTriangulationLayout) {\n    if (!this.focus.equalTo(layout.hull))\n      this.focus = layout.hull;\n    this.$emit('layout', layout)\n    this.$emit('update:inner', this.surface!.halfEdges.filter((he) => layout.layout(he).inner));\n  }\n\n  protected onSVGChanged(svg: string) {\n    this.$emit('svg', svg);\n  }\n\n  @Watch(\"raw\", { immediate: true })\n  onRawChanged() {\n    try {\n      const parsed = YAML.parse(this.raw);\n\n      const vertical = parsed.vertical || {x: 0, y: 1};\n      const angle = new Vector(this.idealCoordinateSystem, 0, 1).angleTo(new Vector(this.idealCoordinateSystem, vertical.x, vertical.y));\n\n      const rotatedCoordinateSystem = new CoordinateSystem(true);\n      rotatedCoordinateSystem.embedInto(this.idealCoordinateSystem, new Flatten.Matrix().rotate(angle));\n\n      this.surface = FlatTriangulation.parse(parsed, rotatedCoordinateSystem);\n      this.components = (parsed.components || []).map((component: any) => FlowComponent.parse(component, rotatedCoordinateSystem));\n      this.automorphisms = (parsed.automorphisms || []).map((automorphism: any) => Automorphism.parse(automorphism));\n      this.$emit('ok');\n    } catch(e) {\n      this.$emit('error', e.message);\n    }\n  }\n}\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??clonedRuleSet-39[0].rules[0].use[0]!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/ts-loader/index.js??clonedRuleSet-39[0].rules[0].use[2]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./SurfaceViewer.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??clonedRuleSet-39[0].rules[0].use[0]!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/ts-loader/index.js??clonedRuleSet-39[0].rules[0].use[2]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./SurfaceViewer.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./SurfaceViewer.vue?vue&type=template&id=9293e716&\"\nimport script from \"./SurfaceViewer.vue?vue&type=script&lang=ts&\"\nexport * from \"./SurfaceViewer.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","export default \"vertices:\\n- - 1\\n  - -3\\n  - -9\\n  - -21\\n  - 14\\n  - 6\\n  - -7\\n  - -17\\n  - -27\\n  - 25\\n  - -26\\n  - 23\\n  - 12\\n  - -13\\n  - 18\\n  - -19\\n  - 10\\n  - 4\\n- - -1\\n  - -5\\n  - -12\\n  - 16\\n  - 7\\n  - 2\\n- - -2\\n  - -6\\n  - -15\\n  - -25\\n  - 24\\n  - 13\\n  - 5\\n  - -4\\n  - -11\\n  - 21\\n  - -20\\n  - 17\\n  - -16\\n  - -23\\n  - 22\\n  - 19\\n  - 8\\n  - 3\\n- - -8\\n  - -18\\n  - -24\\n  - 27\\n  - 20\\n  - 9\\n- - -10\\n  - -22\\n  - 26\\n  - 15\\n  - -14\\n  - 11\\nvectors:\\n  1:\\n    x: 1.0\\n    y: 0.0\\n  2:\\n    x: -0.32635182233306964\\n    y: 0.565257937423568\\n  3:\\n    x: -0.6736481776669303\\n    y: -0.565257937423568\\n  4:\\n    x: 0.6736481776669303\\n    y: -0.565257937423568\\n  5:\\n    x: 0.32635182233306964\\n    y: 0.565257937423568\\n  6:\\n    x: -0.8263518223330697\\n    y: -0.3007674663608706\\n  7:\\n    x: 0.5\\n    y: 0.8660254037844386\\n  8:\\n    x: -0.5\\n    y: 0.41954981558864\\n  9:\\n    x: -0.17364817766693036\\n    y: -0.984807753012208\\n  10:\\n    x: 0.17364817766693036\\n    y: -0.984807753012208\\n  11:\\n    x: 0.5\\n    y: 0.41954981558864\\n  12:\\n    x: -0.5\\n    y: 0.8660254037844386\\n  13:\\n    x: 0.8263518223330697\\n    y: -0.3007674663608706\\n  14:\\n    x: -0.9396926207859084\\n    y: 0.3420201433256687\\n  15:\\n    x: 0.11334079845283873\\n    y: -0.6427876096865394\\n  16:\\n    x: 0.6527036446661393\\n    y: 0.0\\n  17:\\n    x: -0.1527036446661393\\n    y: 0.8660254037844386\\n  18:\\n    x: -0.9396926207859084\\n    y: -0.3420201433256687\\n  19:\\n    x: 0.4396926207859084\\n    y: 0.7615699589143088\\n  20:\\n    x: -0.6133407984528387\\n    y: -0.22323779409789932\\n  21:\\n    x: 0.4396926207859084\\n    y: -0.7615699589143088\\n  22:\\n    x: 0.6133407984528387\\n    y: -0.22323779409789932\\n  23:\\n    x: 0.1527036446661393\\n    y: 0.8660254037844386\\n  24:\\n    x: -0.11334079845283873\\n    y: -0.6427876096865394\\n  25:\\n    x: 0.8793852415718167\\n    y: 0.0\\n  26:\\n    x: -0.766044443118978\\n    y: -0.6427876096865394\\n  27:\\n    x: -0.766044443118978\\n    y: 0.6427876096865394\\ncomponents:\\n- cylinder: true\\n  perimeter:\\n  - source: 25\\n    target: -25\\n    vertical: false\\n    boundary: false\\n    vector:\\n      x: 0.8793852415718167\\n      y: 0.0\\n    crossings: []\\n    touches:\\n    - halfEdge: 25\\n      index: 0\\n    - halfEdge: -25\\n      index: 1\\n  - source: -15\\n    target: 13\\n    vertical: true\\n    boundary: true\\n    vector:\\n      x: -1.7057370639048863\\n      y: 0.3007674663608706\\n    crossings:\\n    - halfEdge: 26\\n      at: 0.8006595491452156\\n    - halfEdge: -23\\n      at: 0.8263518223330697\\n    - halfEdge: -12\\n      at: 0.8006595491452156\\n    touches:\\n    - halfEdge: -15\\n      index: 0\\n    - halfEdge: 26\\n      index: 0\\n    - halfEdge: -26\\n      index: 0\\n    - halfEdge: -23\\n      index: 0\\n    - halfEdge: 23\\n      index: 0\\n    - halfEdge: -12\\n      index: 0\\n    - halfEdge: 12\\n      index: 0\\n    - halfEdge: 13\\n      index: 0\\n  - source: -25\\n    target: 25\\n    vertical: false\\n    boundary: false\\n    vector:\\n      x: -0.8793852415718167\\n      y: 0.0\\n    crossings: []\\n    touches:\\n    - halfEdge: -25\\n      index: 0\\n    - halfEdge: 25\\n      index: 1\\n  - source: -27\\n    target: -13\\n    vertical: true\\n    boundary: true\\n    vector:\\n      x: 1.7057370639048863\\n      y: -0.3007674663608706\\n    crossings:\\n    - halfEdge: -24\\n      at: 0.766044443118978\\n    touches:\\n    - halfEdge: -27\\n      index: 0\\n    - halfEdge: -24\\n      index: 0\\n    - halfEdge: 24\\n      index: 0\\n    - halfEdge: -13\\n      index: 0\\n  inside:\\n  - 13\\n  - -13\\n  - 25\\n  - -25\\n- cylinder: true\\n  perimeter:\\n  - source: 1\\n    target: -1\\n    vertical: false\\n    boundary: false\\n    vector:\\n      x: 1.0\\n      y: 0.0\\n    crossings: []\\n    touches:\\n    - halfEdge: 1\\n      index: 0\\n    - halfEdge: -1\\n      index: 1\\n  - source: 16\\n    target: -16\\n    vertical: false\\n    boundary: false\\n    vector:\\n      x: 0.6527036446661393\\n      y: 0.0\\n    crossings: []\\n    touches:\\n    - halfEdge: 16\\n      index: 0\\n    - halfEdge: -16\\n      index: 1\\n  - source: 17\\n    target: 22\\n    vertical: true\\n    boundary: true\\n    vector:\\n      x: -3.2057370639048863\\n      y: 0.565257937423568\\n    crossings:\\n    - halfEdge: -7\\n      at: 0.8793852415718167\\n    - halfEdge: -2\\n      at: 0.7733184030943225\\n    - halfEdge: 3\\n      at: 0.5739779522395382\\n    - halfEdge: 9\\n      at: 0.713011023880231\\n    - halfEdge: 21\\n      at: 0.5739779522395382\\n    - halfEdge: -11\\n      at: 0.7733184030943225\\n    - halfEdge: 10\\n      at: 0.8793852415718167\\n    touches:\\n    - halfEdge: 17\\n      index: 0\\n    - halfEdge: -7\\n      index: 0\\n    - halfEdge: 7\\n      index: 0\\n    - halfEdge: -2\\n      index: 0\\n    - halfEdge: 2\\n      index: 0\\n    - halfEdge: 3\\n      index: 0\\n    - halfEdge: -3\\n      index: 0\\n    - halfEdge: 9\\n      index: 0\\n    - halfEdge: -9\\n      index: 0\\n    - halfEdge: 21\\n      index: 0\\n    - halfEdge: -21\\n      index: 0\\n    - halfEdge: -11\\n      index: 0\\n    - halfEdge: 11\\n      index: 0\\n    - halfEdge: 10\\n      index: 0\\n    - halfEdge: -10\\n      index: 0\\n    - halfEdge: 22\\n      index: 0\\n  - source: -16\\n    target: 16\\n    vertical: false\\n    boundary: false\\n    vector:\\n      x: -0.6527036446661393\\n      y: 0.0\\n    crossings: []\\n    touches:\\n    - halfEdge: -16\\n      index: 0\\n    - halfEdge: 16\\n      index: 1\\n  - source: -1\\n    target: 1\\n    vertical: false\\n    boundary: false\\n    vector:\\n      x: -1.0\\n      y: 0.0\\n    crossings: []\\n    touches:\\n    - halfEdge: -1\\n      index: 0\\n    - halfEdge: 1\\n      index: 1\\n  - source: 4\\n    target: 14\\n    vertical: true\\n    boundary: true\\n    vector:\\n      x: 3.2057370639048863\\n      y: -0.565257937423568\\n    crossings:\\n    - halfEdge: 5\\n      at: 0.7168814171420514\\n    - halfEdge: 12\\n      at: 0.7733184030943225\\n    - halfEdge: 23\\n      at: 0.6736481776669303\\n    - halfEdge: -26\\n      at: 0.7733184030943225\\n    - halfEdge: -15\\n      at: 0.7168814171420514\\n    touches:\\n    - halfEdge: 4\\n      index: 0\\n    - halfEdge: 5\\n      index: 0\\n    - halfEdge: -5\\n      index: 0\\n    - halfEdge: 12\\n      index: 0\\n    - halfEdge: -12\\n      index: 0\\n    - halfEdge: 23\\n      index: 0\\n    - halfEdge: -23\\n      index: 0\\n    - halfEdge: -26\\n      index: 0\\n    - halfEdge: 26\\n      index: 0\\n    - halfEdge: -15\\n      index: 0\\n    - halfEdge: 15\\n      index: 0\\n    - halfEdge: 14\\n      index: 0\\n  inside:\\n  - 1\\n  - -1\\n  - 14\\n  - -14\\n  - 16\\n  - -16\\n  - 22\\n  - -22\\n- cylinder: true\\n  perimeter:\\n  - source: 22\\n    target: -4\\n    vertical: false\\n    boundary: false\\n    vector:\\n      x: 1.1133407984528387\\n      y: 0.19631202149074067\\n    crossings:\\n    - halfEdge: -10\\n      at: 0.32635182233306964\\n    touches:\\n    - halfEdge: 22\\n      index: 0\\n    - halfEdge: -10\\n      index: 2\\n    - halfEdge: 10\\n      index: 1\\n    - halfEdge: -4\\n      index: 1\\n  - source: -4\\n    target: -2\\n    vertical: true\\n    boundary: true\\n    vector:\\n      x: -3.2057370639048863\\n      y: 0.565257937423568\\n    crossings:\\n    - halfEdge: 10\\n      at: 0.4679111137620439\\n    - halfEdge: -19\\n      at: 0.532088886237956\\n    - halfEdge: 18\\n      at: 0.8793852415718167\\n    - halfEdge: 24\\n      at: 0.9076037345479523\\n    - halfEdge: -27\\n      at: 0.8793852415718167\\n    - halfEdge: -17\\n      at: 0.532088886237956\\n    - halfEdge: -7\\n      at: 0.4679111137620439\\n    touches:\\n    - halfEdge: -4\\n      index: 2\\n    - halfEdge: 10\\n      index: 0\\n    - halfEdge: -10\\n      index: 3\\n    - halfEdge: -19\\n      index: 0\\n    - halfEdge: 19\\n      index: 0\\n    - halfEdge: 18\\n      index: 0\\n    - halfEdge: -18\\n      index: 0\\n    - halfEdge: 24\\n      index: 0\\n    - halfEdge: -24\\n      index: 0\\n    - halfEdge: -27\\n      index: 0\\n    - halfEdge: 27\\n      index: 0\\n    - halfEdge: -17\\n      index: 0\\n    - halfEdge: 17\\n      index: 1\\n    - halfEdge: -7\\n      index: 0\\n    - halfEdge: 7\\n      index: 1\\n    - halfEdge: -2\\n      index: 0\\n  - source: 8\\n    target: 21\\n    vertical: true\\n    boundary: false\\n    vector:\\n      x: -1.1133407984528387\\n      y: 0.19631202149074067\\n    crossings:\\n    - halfEdge: 9\\n      at: 0.32635182233306964\\n    touches:\\n    - halfEdge: 8\\n      index: 0\\n    - halfEdge: 9\\n      index: 1\\n    - halfEdge: -9\\n      index: 1\\n    - halfEdge: 21\\n      index: 1\\n  - source: -4\\n    target: 22\\n    vertical: false\\n    boundary: false\\n    vector:\\n      x: -1.1133407984528387\\n      y: -0.19631202149074067\\n    crossings:\\n    - halfEdge: 10\\n      at: 0.6736481776669303\\n    touches:\\n    - halfEdge: -4\\n      index: 0\\n    - halfEdge: 10\\n      index: 2\\n    - halfEdge: -10\\n      index: 1\\n    - halfEdge: 22\\n      index: 1\\n  - source: 22\\n    target: 17\\n    vertical: true\\n    boundary: true\\n    vector:\\n      x: 3.2057370639048863\\n      y: -0.565257937423568\\n    crossings:\\n    - halfEdge: -10\\n      at: 0.12061475842818323\\n    - halfEdge: 11\\n      at: 0.22668159690567746\\n    - halfEdge: -21\\n      at: 0.4260220477604618\\n    - halfEdge: -9\\n      at: 0.2869889761197691\\n    - halfEdge: -3\\n      at: 0.4260220477604618\\n    - halfEdge: 2\\n      at: 0.22668159690567746\\n    - halfEdge: 7\\n      at: 0.12061475842818323\\n    touches:\\n    - halfEdge: 22\\n      index: 2\\n    - halfEdge: -10\\n      index: 0\\n    - halfEdge: 10\\n      index: 3\\n    - halfEdge: 11\\n      index: 0\\n    - halfEdge: -11\\n      index: 0\\n    - halfEdge: -21\\n      index: 0\\n    - halfEdge: 21\\n      index: 2\\n    - halfEdge: -9\\n      index: 0\\n    - halfEdge: 9\\n      index: 2\\n    - halfEdge: -3\\n      index: 0\\n    - halfEdge: 3\\n      index: 0\\n    - halfEdge: 2\\n      index: 0\\n    - halfEdge: -2\\n      index: 1\\n    - halfEdge: 7\\n      index: 0\\n    - halfEdge: -7\\n      index: 1\\n    - halfEdge: 17\\n      index: 0\\n  - source: 21\\n    target: 8\\n    vertical: true\\n    boundary: false\\n    vector:\\n      x: 1.1133407984528387\\n      y: -0.19631202149074067\\n    crossings:\\n    - halfEdge: -9\\n      at: 0.6736481776669303\\n    touches:\\n    - halfEdge: 21\\n      index: 0\\n    - halfEdge: -9\\n      index: 2\\n    - halfEdge: 9\\n      index: 0\\n    - halfEdge: 8\\n      index: 1\\n  inside:\\n  - 8\\n  - -8\\n  - 20\\n  - -20\\n- cylinder: true\\n  perimeter:\\n  - source: -6\\n    target: 6\\n    vertical: false\\n    boundary: false\\n    vector:\\n      x: 0.8263518223330697\\n      y: 0.3007674663608706\\n    crossings: []\\n    touches:\\n    - halfEdge: -6\\n      index: 0\\n    - halfEdge: 6\\n      index: 1\\n  - source: 14\\n    target: 4\\n    vertical: true\\n    boundary: true\\n    vector:\\n      x: -3.2057370639048863\\n      y: 0.565257937423568\\n    crossings:\\n    - halfEdge: 15\\n      at: 0.28311858285794855\\n    - halfEdge: 26\\n      at: 0.22668159690567746\\n    - halfEdge: -23\\n      at: 0.32635182233306964\\n    - halfEdge: -12\\n      at: 0.22668159690567746\\n    - halfEdge: -5\\n      at: 0.28311858285794855\\n    touches:\\n    - halfEdge: 14\\n      index: 0\\n    - halfEdge: 15\\n      index: 0\\n    - halfEdge: -15\\n      index: 1\\n    - halfEdge: 26\\n      index: 0\\n    - halfEdge: -26\\n      index: 1\\n    - halfEdge: -23\\n      index: 0\\n    - halfEdge: 23\\n      index: 1\\n    - halfEdge: -12\\n      index: 0\\n    - halfEdge: 12\\n      index: 1\\n    - halfEdge: -5\\n      index: 0\\n    - halfEdge: 5\\n      index: 0\\n    - halfEdge: 4\\n      index: 0\\n  - source: -13\\n    target: -27\\n    vertical: true\\n    boundary: true\\n    vector:\\n      x: -1.7057370639048863\\n      y: 0.3007674663608706\\n    crossings:\\n    - halfEdge: 24\\n      at: 0.23395555688102196\\n    touches:\\n    - halfEdge: -13\\n      index: 0\\n    - halfEdge: 24\\n      index: 0\\n    - halfEdge: -24\\n      index: 1\\n    - halfEdge: -27\\n      index: 0\\n  - source: 6\\n    target: -6\\n    vertical: false\\n    boundary: false\\n    vector:\\n      x: -0.8263518223330697\\n      y: -0.3007674663608706\\n    crossings: []\\n    touches:\\n    - halfEdge: 6\\n      index: 0\\n    - halfEdge: -6\\n      index: 1\\n  - source: -2\\n    target: -4\\n    vertical: true\\n    boundary: true\\n    vector:\\n      x: 3.2057370639048863\\n      y: -0.565257937423568\\n    crossings:\\n    - halfEdge: 7\\n      at: 0.532088886237956\\n    - halfEdge: 17\\n      at: 0.4679111137620439\\n    - halfEdge: 27\\n      at: 0.12061475842818323\\n    - halfEdge: -24\\n      at: 0.09239626545204768\\n    - halfEdge: -18\\n      at: 0.12061475842818323\\n    - halfEdge: 19\\n      at: 0.4679111137620439\\n    - halfEdge: -10\\n      at: 0.532088886237956\\n    touches:\\n    - halfEdge: -2\\n      index: 0\\n    - halfEdge: 7\\n      index: 0\\n    - halfEdge: -7\\n      index: 0\\n    - halfEdge: 17\\n      index: 0\\n    - halfEdge: -17\\n      index: 0\\n    - halfEdge: 27\\n      index: 0\\n    - halfEdge: -27\\n      index: 1\\n    - halfEdge: -24\\n      index: 0\\n    - halfEdge: 24\\n      index: 1\\n    - halfEdge: -18\\n      index: 0\\n    - halfEdge: 18\\n      index: 0\\n    - halfEdge: 19\\n      index: 0\\n    - halfEdge: -19\\n      index: 0\\n    - halfEdge: -10\\n      index: 0\\n    - halfEdge: 10\\n      index: 0\\n    - halfEdge: -4\\n      index: 0\\n  - source: 13\\n    target: -15\\n    vertical: true\\n    boundary: true\\n    vector:\\n      x: 1.7057370639048863\\n      y: -0.3007674663608706\\n    crossings:\\n    - halfEdge: 12\\n      at: 0.19934045085478438\\n    - halfEdge: 23\\n      at: 0.17364817766693036\\n    - halfEdge: -26\\n      at: 0.19934045085478438\\n    touches:\\n    - halfEdge: 13\\n      index: 0\\n    - halfEdge: 12\\n      index: 0\\n    - halfEdge: -12\\n      index: 1\\n    - halfEdge: 23\\n      index: 0\\n    - halfEdge: -23\\n      index: 1\\n    - halfEdge: -26\\n      index: 0\\n    - halfEdge: 26\\n      index: 1\\n    - halfEdge: -15\\n      index: 0\\n  inside:\\n  - 4\\n  - -4\\n  - 6\\n  - -6\\n\";","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.cancellation != null && _vm.visible)?_c('v-overlay',{staticClass:\"loading-overlay\",attrs:{\"opacity\":.2,\"z-index\":0}},[_c('v-container',[_c('v-row',[_c('v-col',[_vm._v(\" \"+_vm._s(_vm.name)+\"… \"),_c('v-progress-circular',{attrs:{\"indeterminate\":_vm.value == null,\"value\":_vm.value}})],1)],1),_c('v-row',[_c('v-col',[_c('v-btn',{attrs:{\"color\":\"error\",\"dark\":\"\",\"disabled\":_vm.cancellation.cancelled},on:{\"click\":function () { return _vm.cancellation.cancel(); }}},[_vm._v(\"Cancel\")])],1)],1)],1)],1):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport { Component, Prop, Vue, Watch } from \"vue-property-decorator\";\nimport CancellationToken from \"../src/CancellationToken\";\nimport Progress from \"../src/Progress\";\n\n@Component\nexport default class Overlay extends Vue {\n  @Prop({required: true}) cancellation!: CancellationToken | null;\n  @Prop({required: true}) progress!: Progress | null;\n\n  visible = false;\n\n  @Watch(\"cancellation\", {immediate: true})\n  onCancellation(value: CancellationToken) {\n    if (value == null)\n      this.visible = false;\n    else\n      setTimeout(() => {\n        if (this.cancellation === value)\n          this.visible = true\n      }, 150);\n  }\n\n  get name() {\n    return this.progress!.stats.name;\n  }\n\n  get value() : number | null {\n    if (this.progress!.stats.step == null || this.progress!.stats.steps == null)\n      return null;\n    return this.progress!.stats.step / this.progress!.stats.steps * 100;\n  }\n}\n","import mod from \"-!../node_modules/cache-loader/dist/cjs.js??clonedRuleSet-39[0].rules[0].use[0]!../node_modules/thread-loader/dist/cjs.js!../node_modules/ts-loader/index.js??clonedRuleSet-39[0].rules[0].use[2]!../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Overlay.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/cache-loader/dist/cjs.js??clonedRuleSet-39[0].rules[0].use[0]!../node_modules/thread-loader/dist/cjs.js!../node_modules/ts-loader/index.js??clonedRuleSet-39[0].rules[0].use[2]!../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Overlay.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Overlay.vue?vue&type=template&id=3e466302&scoped=true&\"\nimport script from \"./Overlay.vue?vue&type=script&lang=ts&\"\nexport * from \"./Overlay.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Overlay.vue?vue&type=style&index=0&id=3e466302&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3e466302\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCol } from 'vuetify/lib/components/VGrid';\nimport { VContainer } from 'vuetify/lib/components/VGrid';\nimport { VOverlay } from 'vuetify/lib/components/VOverlay';\nimport { VProgressCircular } from 'vuetify/lib/components/VProgressCircular';\nimport { VRow } from 'vuetify/lib/components/VGrid';\ninstallComponents(component, {VBtn,VCol,VContainer,VOverlay,VProgressCircular,VRow})\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport { Component, Provide, Vue } from \"vue-property-decorator\";\nimport PanZoom from \"@/components/PanZoom.vue\";\nimport SurfaceViewer from \"@/components/SurfaceViewer.vue\";\nimport dump from \"!!raw-loader!./2-3-4-pullback-flow.txt\";\nimport CancellationToken from \"@/CancellationToken\";\nimport Progress from \"@/Progress\";\nimport Overlay from \"./Overlay.vue\";\n\n@Component({\n  components: {\n    Overlay,\n    PanZoom,\n    SurfaceViewer,\n  }\n})\nexport default class App extends Vue {\n  raw = dump;\n  editor = false;\n  svg = false;\n  svgExport = null;\n  overlay = null as CancellationToken | null;\n  error = null as string | null;\n  progress = null as Progress | null;\n\n  @Provide()\n  async run(callback: (cancellation: CancellationToken, progress: Progress) => Promise<void>) {\n    // Any previous run is supposedly cancelled already so we can safely throw\n    // away its cancellation and progress tokens.\n    const cancellation = new CancellationToken();\n    this.overlay = cancellation;\n    this.progress = new Progress();\n    try {\n      await callback(this.overlay, this.progress);\n    } finally {\n      if (this.overlay === cancellation)\n        // We came here because this process completed. Remove the overlay.\n        this.overlay = null;\n    }\n  }\n\n  onError(message: string | null = null) {\n    this.error= message;\n  }\n}\n","import mod from \"-!../node_modules/cache-loader/dist/cjs.js??clonedRuleSet-39[0].rules[0].use[0]!../node_modules/thread-loader/dist/cjs.js!../node_modules/ts-loader/index.js??clonedRuleSet-39[0].rules[0].use[2]!../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/cache-loader/dist/cjs.js??clonedRuleSet-39[0].rules[0].use[0]!../node_modules/thread-loader/dist/cjs.js!../node_modules/ts-loader/index.js??clonedRuleSet-39[0].rules[0].use[2]!../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=34a12f70&scoped=true&\"\nimport script from \"./App.vue?vue&type=script&lang=ts&\"\nexport * from \"./App.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./App.vue?vue&type=style&index=0&id=34a12f70&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"34a12f70\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VApp } from 'vuetify/lib/components/VApp';\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCard } from 'vuetify/lib/components/VCard';\nimport { VCardTitle } from 'vuetify/lib/components/VCard';\nimport { VContainer } from 'vuetify/lib/components/VGrid';\nimport { VDialog } from 'vuetify/lib/components/VDialog';\nimport { VForm } from 'vuetify/lib/components/VForm';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VMain } from 'vuetify/lib/components/VMain';\nimport { VTextarea } from 'vuetify/lib/components/VTextarea';\nimport { VToolbar } from 'vuetify/lib/components/VToolbar';\ninstallComponents(component, {VApp,VBtn,VCard,VCardTitle,VContainer,VDialog,VForm,VIcon,VMain,VTextarea,VToolbar})\n","import Vue, { VNode } from 'vue';\nimport App from './App.vue';\nimport Vuetify from 'vuetify/lib';\nimport '@mdi/font/css/materialdesignicons.css'\n\nVue.config.productionTip = false;\n\nVue.use(Vuetify);\n\nnew Vue({\n    render: (h): VNode => h(App),\n    vuetify: new Vuetify({}),\n}).$mount('#app');\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","var deferred = [];\n__webpack_require__.O = function(result, chunkIds, fn, priority) {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar chunkIds = deferred[i][0];\n\t\tvar fn = deferred[i][1];\n\t\tvar priority = deferred[i][2];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every(function(key) { return __webpack_require__.O[key](chunkIds[j]); })) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t143: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = function(chunkId) { return installedChunks[chunkId] === 0; };\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = function(parentChunkLoadingFunction, data) {\n\tvar chunkIds = data[0];\n\tvar moreModules = data[1];\n\tvar runtime = data[2];\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tfor(moduleId in moreModules) {\n\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t}\n\t}\n\tif(runtime) var result = runtime(__webpack_require__);\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkIds[i]] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkvue_flatsurf\"] = self[\"webpackChunkvue_flatsurf\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [998], function() { return __webpack_require__(8876); })\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"sourceRoot":""}